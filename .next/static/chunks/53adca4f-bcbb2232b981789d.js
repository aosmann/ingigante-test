"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3510],{60814:function(e,t,n){n.d(t,{L9:function(){return tw},_F:function(){return tE},iV:function(){return t1},q$:function(){return tI}});var r,i,l,a,o,s,c=n(85893),h=n(67294),f=n(19917),p=n(42006),d=n(34978),u=n(32817),g=n(1545),m=n(51313),y=n(82649),k=n(42076),_=n(62997),b=n.n(_),x=n(57122),w=n(74362),M=n(77493),E=n(18446),T=n.n(E),N=n(50308),D=n.n(N),A=n(14176),C=n.n(A),L=n(52353),S=n.n(L),P=n(27361),R=n.n(P),I=n(85564),B=n.n(I),j=n(42930),O=n(13218),Y=n.n(O),W=n(47037),J=n.n(W),z=n(30998),F=n.n(z),V=n(57557),U=n.n(V),H=n(66678),$=n.n(H),q=n(44908),Z=n.n(q),G=n(18156),K=n(76590),X=n(23279),Q=n.n(X),ee=n(14141);function et(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function en(e){return k.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}function er(e){var t,n,r;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let i=null==(t=e.of)?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!i)throw Error("Block type is not defined in this schema (required)");let l=null==(n=i.fields)?void 0:n.find(e=>"children"===e.name);if(!l)throw Error("Children field for block type found in schema (required)");let a=l.type.of;if(!a)throw Error("Valid types for block children not found in schema (required)");let o=a.find(e=>"span"===e.name);if(!o)throw Error("Span type not found in schema (required)");let s=a.filter(e=>"span"!==e.name)||[],c=(null==(r=e.of)?void 0:r.filter(e=>e.name!==i.name))||[];return{styles:function(e){var t,n,r;let i=null==(t=e.fields)?void 0:t.find(e=>"style"===e.name);if(!i)throw Error("A field with name 'style' is not defined in the block type (required).");let l=(null==(n=i.type.options)?void 0:n.list)&&(null==(r=i.type.options.list)?void 0:r.filter(e=>e.value));if(!l||0===l.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return l}(i),decorators:o.decorators,lists:function(e){var t,n;let r=null==(t=e.fields)?void 0:t.find(e=>"list"===e.name);if(!r)throw Error("A field with name 'list' is not defined in the block type (required).");let i=(null==(n=r.type.options)?void 0:n.list)&&r.type.options.list.filter(e=>e.value);if(!i)throw Error("The list field need at least to be an empty array");return i}(i),block:i,span:o,portableText:e,inlineObjects:s,blockObjects:c,annotations:o.annotations}}let ei="sanity-pte:";function el(e){let t="".concat(ei).concat(e);return b()&&b().enabled(t)?b()(t):b()(ei)}b()(ei);let ea=()=>(0,x.E2)(12),eo=(0,h.createContext)(ea),es=()=>{let e=(0,h.useContext)(eo);if(void 0===e)throw Error("The `usePortableTextEditorKeyGenerator` hook must be used inside the <PortableTextEditor> component's context.");return e},ec=new WeakMap,eh=new WeakMap,ef=new WeakMap,ep=new WeakMap,ed=new WeakMap,eu=new WeakMap,eg=new WeakMap,em=new WeakMap,ey=new WeakMap,ek=[];function ev(e,t){let n=t[e._key];return n&&T()(e,n)?n:(t[e._key]=e,e)}function e_(e,t){let{schemaTypes:n}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:i,...l}=e,a=[{_key:"".concat(i,"-void-child"),_type:"span",text:"",marks:[]}],o=e&&e._type===n.block.name;if(o){let o=!1,s=void 0===e.style,c=void 0===e.markDefs,h=e.children.map(e=>{let{_type:t,_key:n,...i}=e;return"span"!==t?(o=!0,ev({_type:t,_key:n,children:a,value:i,__inline:!0},r)):e});return!s&&!c&&!o&&M.W_.isElement(e)?e:(s&&(l.style=n.styles[0].value),c&&(l.markDefs=ek),ev({_type:t,_key:i,...l,children:h},r))}return ev({_type:t,_key:i,children:a,value:l},r)}):[]}function eb(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:r,_type:i}=e;if(!r||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&r){let t=!1,l=e.children.map(e=>{let{_type:r}=e;if("value"in e&&"span"!==r){t=!0;let{value:r,_key:i,_type:l,__inline:a,children:o,...s}=e;return ev({...s,...r,_key:i,_type:l},n)}return e});return t?ev({...e,children:l,_key:r,_type:i},n):e}let l="value"in e&&e.value;return ev({_key:r,_type:i,..."object"==typeof l?l:{}},n)})}function ex(e,t){var n;return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&M.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&M.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!(null==(n=e[0].children[0].marks)?void 0:n.join(""))&&""===e[0].children[0].text}var ew={};function eM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"setIfMissing",path:t,value:e}}r={get exports(){return ew},set exports(v){ew=v}},(i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}).Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:new Date().getTime()+1e3*this.Diff_Timeout);var l=r;if(null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var a=n,o=this.diff_commonPrefix(e,t),s=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var c=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var h=this.diff_compute_(e,t,a,l);return s&&h.unshift(new i.Diff(0,s)),c&&h.push(new i.Diff(0,c)),this.diff_cleanupMerge(h),h},i.prototype.diff_compute_=function(e,t,n,r){if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(-1,e)];var l,a=e.length>t.length?e:t,o=e.length>t.length?t:e,s=a.indexOf(o);if(-1!=s)return l=[new i.Diff(1,a.substring(0,s)),new i.Diff(0,o),new i.Diff(1,a.substring(s+o.length))],e.length>t.length&&(l[0][0]=l[2][0]=-1),l;if(1==o.length)return[new i.Diff(-1,e),new i.Diff(1,t)];var c=this.diff_halfMatch_(e,t);if(c){var h=c[0],f=c[1],p=c[2],d=c[3],u=c[4],g=this.diff_main(h,p,n,r),m=this.diff_main(f,d,n,r);return g.concat([new i.Diff(0,u)],m)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},i.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var l=r.lineArray,a=this.diff_main(e,t,!1,n);this.diff_charsToLines_(a,l),this.diff_cleanupSemantic(a),a.push(new i.Diff(0,""));for(var o=0,s=0,c=0,h="",f="";o<a.length;){switch(a[o][0]){case 1:c++,f+=a[o][1];break;case -1:s++,h+=a[o][1];break;case 0:if(s>=1&&c>=1){a.splice(o-s-c,s+c),o=o-s-c;for(var p=this.diff_main(h,f,!1,n),d=p.length-1;d>=0;d--)a.splice(o,0,p[d]);o+=p.length}c=0,s=0,h="",f=""}o++}return a.pop(),a},i.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,l=t.length,a=Math.ceil((r+l)/2),o=2*a,s=Array(o),c=Array(o),h=0;h<o;h++)s[h]=-1,c[h]=-1;s[a+1]=0,c[a+1]=0;for(var f=r-l,p=f%2!=0,d=0,u=0,g=0,m=0,y=0;y<a&&!(new Date().getTime()>n);y++){for(var k=-y+d;k<=y-u;k+=2){for(var _,b=a+k,x=(_=k==-y||k!=y&&s[b-1]<s[b+1]?s[b+1]:s[b-1]+1)-k;_<r&&x<l&&e.charAt(_)==t.charAt(x);)_++,x++;if(s[b]=_,_>r)u+=2;else if(x>l)d+=2;else if(p){var w=a+f-k;if(w>=0&&w<o&&-1!=c[w]){var M=r-c[w];if(_>=M)return this.diff_bisectSplit_(e,t,_,x,n)}}}for(var E=-y+g;E<=y-m;E+=2){for(var M,w=a+E,T=(M=E==-y||E!=y&&c[w-1]<c[w+1]?c[w+1]:c[w-1]+1)-E;M<r&&T<l&&e.charAt(r-M-1)==t.charAt(l-T-1);)M++,T++;if(c[w]=M,M>r)m+=2;else if(T>l)g+=2;else if(!p){var b=a+f-E;if(b>=0&&b<o&&-1!=s[b]){var _=s[b],x=a+_-b;if(_>=(M=r-M))return this.diff_bisectSplit_(e,t,_,x,n)}}}}return[new i.Diff(-1,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,r,i){var l=e.substring(0,n),a=t.substring(0,r),o=e.substring(n),s=t.substring(r),c=this.diff_main(l,a,!1,i),h=this.diff_main(o,s,!1,i);return c.concat(h)},i.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,a=-1,o=n.length;a<e.length-1;){-1==(a=e.indexOf("\n",i))&&(a=e.length-1);var s=e.substring(i,a+1);(r.hasOwnProperty?r.hasOwnProperty(s):void 0!==r[s])?t+=String.fromCharCode(r[s]):(o==l&&(s=e.substring(i),a=e.length),t+=String.fromCharCode(o),r[s]=o,n[o++]=s),i=a+1}return t}n[0]="";var l=4e4;return l=65535,{chars1:i(e),chars2:i(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],l=0;l<r.length;l++)i[l]=t[r.charCodeAt(l)];e[n][1]=i.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(l,i)==t.substring(l,i)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,l=0;n<i;)e.substring(e.length-i,e.length-l)==t.substring(t.length-i,t.length-l)?l=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var l=0,a=1;;){var o=e.substring(i-a),s=t.indexOf(o);if(-1==s)return l;a+=s,(0==s||e.substring(i-a)==t.substring(0,a))&&(l=a,a++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n,r,i,l,a,o=e.length>t.length?e:t,s=e.length>t.length?t:e;if(o.length<4||2*s.length<o.length)return null;var c=this;function h(e,t,n){for(var r,i,l,a,o=e.substring(n,n+Math.floor(e.length/4)),s=-1,h="";-1!=(s=t.indexOf(o,s+1));){var f=c.diff_commonPrefix(e.substring(n),t.substring(s)),p=c.diff_commonSuffix(e.substring(0,n),t.substring(0,s));h.length<p+f&&(h=t.substring(s-p,s)+t.substring(s,s+f),r=e.substring(0,n-p),i=e.substring(n+f),l=t.substring(0,s-p),a=t.substring(s+f))}return 2*h.length>=e.length?[r,i,l,a,h]:null}var f=h(o,s,Math.ceil(o.length/4)),p=h(o,s,Math.ceil(o.length/2));return f||p?(n=p?f&&f[4].length>p[4].length?f:p:f,e.length>t.length?(r=n[0],i=n[1],l=n[2],a=n[3]):(l=n[0],a=n[1],r=n[2],i=n[3]),[r,i,l,a,n[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,l=null,a=0,o=0,s=0,c=0,h=0;a<e.length;)0==e[a][0]?(n[r++]=a,o=c,s=h,c=0,h=0,l=e[a][1]):(1==e[a][0]?c+=e[a][1].length:h+=e[a][1].length,l&&l.length<=Math.max(o,s)&&l.length<=Math.max(c,h)&&(e.splice(n[r-1],0,new i.Diff(-1,l)),e[n[r-1]+1][0]=1,r--,a=--r>0?n[r-1]:-1,o=0,s=0,c=0,h=0,l=null,t=!0)),a++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),a=1;a<e.length;){if(-1==e[a-1][0]&&1==e[a][0]){var f=e[a-1][1],p=e[a][1],d=this.diff_commonOverlap_(f,p),u=this.diff_commonOverlap_(p,f);d>=u?(d>=f.length/2||d>=p.length/2)&&(e.splice(a,0,new i.Diff(0,p.substring(0,d))),e[a-1][1]=f.substring(0,f.length-d),e[a+1][1]=p.substring(d),a++):(u>=f.length/2||u>=p.length/2)&&(e.splice(a,0,new i.Diff(0,f.substring(0,u))),e[a-1][0]=1,e[a-1][1]=p.substring(0,p.length-u),e[a+1][0]=-1,e[a+1][1]=f.substring(u),a++),a++}a++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),l=n.match(i.nonAlphaNumericRegex_),a=r.match(i.nonAlphaNumericRegex_),o=l&&n.match(i.whitespaceRegex_),s=a&&r.match(i.whitespaceRegex_),c=o&&n.match(i.linebreakRegex_),h=s&&r.match(i.linebreakRegex_),f=c&&e.match(i.blanklineEndRegex_),p=h&&t.match(i.blanklineStartRegex_);return f||p?5:c||h?4:l&&!o&&s?3:o||s?2:l||a?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var r=e[n-1][1],l=e[n][1],a=e[n+1][1],o=this.diff_commonSuffix(r,l);if(o){var s=l.substring(l.length-o);r=r.substring(0,r.length-o),l=s+l.substring(0,l.length-o),a=s+a}for(var c=r,h=l,f=a,p=t(r,l)+t(l,a);l.charAt(0)===a.charAt(0);){r+=l.charAt(0),l=l.substring(1)+a.charAt(0),a=a.substring(1);var d=t(r,l)+t(l,a);d>=p&&(p=d,c=r,h=l,f=a)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=h,f?e[n+1][1]=f:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],r=0,l=null,a=0,o=!1,s=!1,c=!1,h=!1;a<e.length;)0==e[a][0]?(e[a][1].length<this.Diff_EditCost&&(c||h)?(n[r++]=a,o=c,s=h,l=e[a][1]):(r=0,l=null),c=h=!1):(-1==e[a][0]?h=!0:c=!0,l&&(o&&s&&c&&h||l.length<this.Diff_EditCost/2&&o+s+c+h==3)&&(e.splice(n[r-1],0,new i.Diff(-1,l)),e[n[r-1]+1][0]=1,r--,l=null,o&&s?(c=h=!0,r=0):(a=--r>0?n[r-1]:-1,c=h=!1),t=!0)),a++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,r=0,l=0,a="",o="";n<e.length;)switch(e[n][0]){case 1:l++,o+=e[n][1],n++;break;case -1:r++,a+=e[n][1],n++;break;case 0:r+l>1?(0!==r&&0!==l&&(0!==(t=this.diff_commonPrefix(o,a))&&(n-r-l>0&&0==e[n-r-l-1][0]?e[n-r-l-1][1]+=o.substring(0,t):(e.splice(0,0,new i.Diff(0,o.substring(0,t))),n++),o=o.substring(t),a=a.substring(t)),0!==(t=this.diff_commonSuffix(o,a))&&(e[n][1]=o.substring(o.length-t)+e[n][1],o=o.substring(0,o.length-t),a=a.substring(0,a.length-t))),n-=r+l,e.splice(n,r+l),a.length&&(e.splice(n,0,new i.Diff(-1,a)),n++),o.length&&(e.splice(n,0,new i.Diff(1,o)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,l=0,r=0,a="",o=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,r=0,i=0,l=0,a=0;for(n=0;n<e.length&&(1!==e[n][0]&&(r+=e[n][1].length),-1!==e[n][0]&&(i+=e[n][1].length),!(r>t));n++)l=r,a=i;return e.length!=n&&-1===e[n][0]?a:a+(t-l)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,i=/>/g,l=/\n/g,a=0;a<e.length;a++){var o=e[a][0],s=e[a][1].replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(l,"&para;<br>");switch(o){case 1:t[a]='<ins style="background:#e6ffe6;">'+s+"</ins>";break;case -1:t[a]='<del style="background:#ffe6e6;">'+s+"</del>";break;case 0:t[a]="<span>"+s+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var l=e[i][0],a=e[i][1];switch(l){case 1:n+=a.length;break;case -1:r+=a.length;break;case 0:t+=Math.max(n,r),n=0,r=0}}return t+Math.max(n,r)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case -1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],r=0,l=0,a=t.split(/\t/g),o=0;o<a.length;o++){var s=a[o].substring(1);switch(a[o].charAt(0)){case"+":try{n[r++]=new i.Diff(1,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var c=parseInt(s,10);if(isNaN(c)||c<0)throw Error("Invalid number in diff_fromDelta: "+s);var h=e.substring(l,l+=c);"="==a[o].charAt(0)?n[r++]=new i.Diff(0,h):n[r++]=new i.Diff(-1,h);break;default:if(a[o])throw Error("Invalid diff operation in diff_fromDelta: "+a[o])}}if(l!=e.length)throw Error("Delta length ("+l+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw Error("Null input. (match_main)");return(n=Math.max(0,Math.min(n,e.length)),e==t)?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r,i,l,a=this.match_alphabet_(t),o=this;function s(e,r){var i=e/t.length,l=Math.abs(n-r);return o.Match_Distance?i+l/o.Match_Distance:l?1:i}var c=this.Match_Threshold,h=e.indexOf(t,n);-1!=h&&(c=Math.min(s(0,h),c),-1!=(h=e.lastIndexOf(t,n+t.length))&&(c=Math.min(s(0,h),c)));var f=1<<t.length-1;h=-1;for(var p=t.length+e.length,d=0;d<t.length;d++){for(r=0,i=p;r<i;)s(d,n+i)<=c?r=i:p=i,i=Math.floor((p-r)/2+r);p=i;var u=Math.max(1,n-i+1),g=Math.min(n+i,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<d)-1;for(var y=g;y>=u;y--){var k=a[e.charAt(y-1)];if(0===d?m[y]=(m[y+1]<<1|1)&k:m[y]=(m[y+1]<<1|1)&k|((l[y+1]|l[y])<<1|1)|l[y+1],m[y]&f){var _=s(d,y-1);if(_<=c){if(c=_,(h=y-1)>n)u=Math.max(1,2*n-h);else break}}}if(s(d+1,n)>c)break;l=m}return h},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var l=t.substring(e.start2-r,e.start2);l&&e.diffs.unshift(new i.Diff(0,l));var a=t.substring(e.start2+e.length1,e.start2+e.length1+r);a&&e.diffs.push(new i.Diff(0,a)),e.start1-=l.length,e.start2-=l.length,e.length1+=l.length+a.length,e.length2+=l.length+a.length}},i.prototype.patch_make=function(e,t,n){if("string"==typeof e&&"string"==typeof t&&void 0===n)r=e,(l=this.diff_main(r,t,!0)).length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)l=e,r=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)r=e,l=t;else if("string"==typeof e&&"string"==typeof t&&n&&"object"==typeof n)r=e,l=n;else throw Error("Unknown call format to patch_make.");if(0===l.length)return[];for(var r,l,a=[],o=new i.patch_obj,s=0,c=0,h=0,f=r,p=r,d=0;d<l.length;d++){var u=l[d][0],g=l[d][1];switch(s||0===u||(o.start1=c,o.start2=h),u){case 1:o.diffs[s++]=l[d],o.length2+=g.length,p=p.substring(0,h)+g+p.substring(h);break;case -1:o.length1+=g.length,o.diffs[s++]=l[d],p=p.substring(0,h)+p.substring(h+g.length);break;case 0:g.length<=2*this.Patch_Margin&&s&&l.length!=d+1?(o.diffs[s++]=l[d],o.length1+=g.length,o.length2+=g.length):g.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(o,f),a.push(o),o=new i.patch_obj,s=0,f=p,c=h)}1!==u&&(c+=g.length),-1!==u&&(h+=g.length)}return s&&(this.patch_addContext_(o,f),a.push(o)),a},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],l=new i.patch_obj;l.diffs=[];for(var a=0;a<r.diffs.length;a++)l.diffs[a]=new i.Diff(r.diffs[a][0],r.diffs[a][1]);l.start1=r.start1,l.start2=r.start2,l.length1=r.length1,l.length2=r.length2,t[n]=l}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,i=[],l=0;l<e.length;l++){var a=e[l].start2+r,o=this.diff_text1(e[l].diffs),s=-1;if(o.length>this.Match_MaxBits?-1!=(h=this.match_main(t,o.substring(0,this.Match_MaxBits),a))&&(-1==(s=this.match_main(t,o.substring(o.length-this.Match_MaxBits),a+o.length-this.Match_MaxBits))||h>=s)&&(h=-1):h=this.match_main(t,o,a),-1==h)i[l]=!1,r-=e[l].length2-e[l].length1;else if(i[l]=!0,r=h-a,f=-1==s?t.substring(h,h+o.length):t.substring(h,s+this.Match_MaxBits),o==f)t=t.substring(0,h)+this.diff_text2(e[l].diffs)+t.substring(h+o.length);else{var c=this.diff_main(o,f,!1);if(o.length>this.Match_MaxBits&&this.diff_levenshtein(c)/o.length>this.Patch_DeleteThreshold)i[l]=!1;else{this.diff_cleanupSemanticLossless(c);for(var h,f,p,d=0,u=0;u<e[l].diffs.length;u++){var g=e[l].diffs[u];0!==g[0]&&(p=this.diff_xIndex(c,d)),1===g[0]?t=t.substring(0,h+p)+g[1]+t.substring(h+p):-1===g[0]&&(t=t.substring(0,h+p)+t.substring(h+this.diff_xIndex(c,d+g[1].length))),-1!==g[0]&&(d+=g[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),i]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var l=e[0],a=l.diffs;if(0==a.length||0!=a[0][0])a.unshift(new i.Diff(0,n)),l.start1-=t,l.start2-=t,l.length1+=t,l.length2+=t;else if(t>a[0][1].length){var o=t-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],l.start1-=o,l.start2-=o,l.length1+=o,l.length2+=o}if(0==(a=(l=e[e.length-1]).diffs).length||0!=a[a.length-1][0])a.push(new i.Diff(0,n)),l.length1+=t,l.length2+=t;else if(t>a[a.length-1][1].length){var o=t-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,o),l.length1+=o,l.length2+=o}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var r=e[n];e.splice(n--,1);for(var l=r.start1,a=r.start2,o="";0!==r.diffs.length;){var s=new i.patch_obj,c=!0;for(s.start1=l-o.length,s.start2=a-o.length,""!==o&&(s.length1=s.length2=o.length,s.diffs.push(new i.Diff(0,o)));0!==r.diffs.length&&s.length1<t-this.Patch_Margin;){var h=r.diffs[0][0],f=r.diffs[0][1];1===h?(s.length2+=f.length,a+=f.length,s.diffs.push(r.diffs.shift()),c=!1):-1===h&&1==s.diffs.length&&0==s.diffs[0][0]&&f.length>2*t?(s.length1+=f.length,l+=f.length,c=!1,s.diffs.push(new i.Diff(h,f)),r.diffs.shift()):(f=f.substring(0,t-s.length1-this.Patch_Margin),s.length1+=f.length,l+=f.length,0===h?(s.length2+=f.length,a+=f.length):c=!1,s.diffs.push(new i.Diff(h,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}o=(o=this.diff_text2(s.diffs)).substring(o.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==p&&(s.length1+=p.length,s.length2+=p.length,0!==s.diffs.length&&0===s.diffs[s.diffs.length-1][0]?s.diffs[s.diffs.length-1][1]+=p:s.diffs.push(new i.Diff(0,p))),c||e.splice(++n,0,s)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),r=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<n.length;){var a=n[r].match(l);if(!a)throw Error("Invalid patch string: "+n[r]);var o=new i.patch_obj;for(t.push(o),o.start1=parseInt(a[1],10),""===a[2]?(o.start1--,o.length1=1):"0"==a[2]?o.length1=0:(o.start1--,o.length1=parseInt(a[2],10)),o.start2=parseInt(a[3],10),""===a[4]?(o.start2--,o.length2=1):"0"==a[4]?o.length2=0:(o.start2--,o.length2=parseInt(a[4],10)),r++;r<n.length;){var s=n[r].charAt(0);try{var c=decodeURI(n[r].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+c)}if("-"==s)o.diffs.push(new i.Diff(-1,c));else if("+"==s)o.diffs.push(new i.Diff(1,c));else if(" "==s)o.diffs.push(new i.Diff(0,c));else if("@"==s)break;else if(""===s);else throw Error('Invalid patch mode "'+s+'" in: '+c);r++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,n=["@@ -"+e+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],r=0;r<this.diffs.length;r++){switch(this.diffs[r][0]){case 1:t="+";break;case -1:t="-";break;case 0:t=" "}n[r+1]=t+encodeURI(this.diffs[r][1])+"\n"}return n.join("").replace(/%20/g," ")},r.exports=i,r.exports.diff_match_patch=i,r.exports.DIFF_DELETE=-1,r.exports.DIFF_INSERT=1,r.exports.DIFF_EQUAL=0;let eE=new ew.diff_match_patch;function eT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=eE.patch_make(e,t).map(e=>e.toString()).join("");return{type:"diffMatchPatch",path:n,value:r}}function eN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"insert",path:n,position:t,items:e}}function eD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"set",path:t,value:e}}function eA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"unset",path:e}}let eC=el("operationToPatches");function eL(e,t,n){let r;let i=[e.path[0]];if(!t)return null;let l=t[i[0]];if(!l)return null;let a=[{_key:l._key}];if(l._type!==n.block.name)return a;let o=e.path.slice(0,2),s=Array.isArray(l.children)&&l.children[o[1]];return s&&(r=["children",{_key:s._key}]),r?[...a,...r]:a}function eS(e,t){if(!t)return[];let[n,r]=Array.from(M.ML.nodes(t,{at:[],match:t=>(0,j.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!M.W_.isElement(n))return[];if(t.isVoid(n))return r;let i=[e.path[2]],l=n.children.findIndex(e=>T()([{_key:e._key}],i));if(l>=0&&n.children[l]){let e=n.children[l];return M.W_.isElement(e)&&t.isVoid(e)?r.concat(l).concat(0):r.concat(l)}return r}function eP(e,t,n){if(!t)return null;let r=null,i=null,l=t.anchor&&eL(t.anchor,e,n);l&&t.anchor&&(r={path:l,offset:t.anchor.offset});let a=t.focus&&eL(t.focus,e,n);return a&&t.focus&&(i={path:a,offset:t.focus.offset}),r&&i?{anchor:r,focus:i}:null}function eR(e,t){if(!e||!t)return null;let n={path:eS(e.anchor,t),offset:e.anchor.offset},r={path:eS(e.focus,t),offset:e.focus.offset};return n&&r?{anchor:n,focus:r}:null}let eI=el("API:editable"),eB=new WeakMap;function ej(e,t){let n=eB.get(e);eB.set(e,!0),t(),eB.set(e,!n)}let eO=new WeakMap;function eY(e,t){let n=eO.get(e);eO.set(e,!1),t(),eO.set(e,n)}let eW="before",eJ="after";function ez(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e.concat(t),[])}let eF=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),eV={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},inc:(e,t)=>e+t,dec:(e,t)=>e-t},eU=Object.keys(eV),eH=new ew.diff_match_patch,e$={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},diffMatchPatch:(e,t)=>eH.patch_apply(eH.patch_fromText(t),e)[0]},eq=Object.keys(e$);function eZ(e,t){let n=Array.isArray(e)?function(e,t){let n=e.slice();if(0===t.path.length){if("setIfMissing"===t.type){if(!Array.isArray(t.value))throw Error("Cannot set value of an array to a non-array");return void 0===e?t.value:e}if("set"===t.type){if(!Array.isArray(t.value))throw Error("Cannot set value of an array to a non-array");return t.value}if("unset"===t.type)return;if("move"===t.type){if(!t.value||!eF(t.value,"from")||!eF(t.value,"to"))throw Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(t.value)));return function(e,t,n){let r=e.slice(),i=r[t];return r.splice(t,1),r.splice(n,0,i),r}(n,t.value.from,t.value.to)}throw Error("Invalid array operation: ".concat(t.type))}let[r,...i]=t.path,l=function(e,t){if("number"==typeof t)return t;let n=F()(e,t);return -1!==n&&n}(e,r);if(!1===l)return n;if(0===i.length){if("insert"===t.type){let{position:n,items:r}=t;return function(e,t,n){if(t!==eW&&t!==eJ)throw Error('Invalid position "'.concat(t,'", must be either ').concat(eW," or ").concat(eJ));for(var r=arguments.length,i=Array(r>3?r-3:0),l=3;l<r;l++)i[l-3]=arguments[l];let a=ez(...i);if(0===e.length)return a;let o=e.length,s=Math.abs((o+n)%o)%o,c=e.slice();return c.splice("after"===t?s+1:s,0,...ez(a)),c}(e,n,l,r)}if("unset"===t.type){if("number"!=typeof l)throw Error('Expected array index to be a number, instead got "'.concat(l,'"'));return n.splice(l,1),n}}return n[l]=eZ(n[l],{...t,path:i}),n}(e,t):J()(e)?function(e,t){if(!eq.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for string. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on string values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));let n=e$[t.type];if(n)return n(e,t.value);throw Error("Unknown patch type")}(e,t):Y()(e)?function(e,t){let n=$()(e);if(0===t.path.length){if("set"===t.type){if(!Y()(t.value))throw Error("Cannot set value of an object to a non-object");return t.value}if("unset"===t.type)return;if("setIfMissing"===t.type)return void 0===e?t.value:e;throw Error("Invalid object operation: ".concat(t.type))}let[r,...i]=t.path;if("string"!=typeof r)throw Error("Expected field name to be a string, instad got: ".concat(r));return 0===i.length&&"unset"===t.type?U()(n,r):(n[r]=eZ(n[r],{...t,path:i}),n)}(e,t):function(e,t){if(!eU.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for primitives. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.map(e=>JSON.stringify(e)).join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));return eV[t.type](e,t.value)}(e,t);return n}let eG=el("operationToPatches"),eK=new ew.diff_match_patch;function eX(e){return"object"==typeof e&&"_key"in e}function eQ(e){let t=null;return e.concat("").reverse().forEach(e=>{eX(e)&&(t=e._key)}),t}function e0(e,t){eG("Children ".concat(t,":"),JSON.stringify(e.children,null,2)),eG("Selection ".concat(t,": "),JSON.stringify(e.selection,null,2))}let e1=el("plugin:withUndoRedo"),e2=new ew.diff_match_patch,e3=new WeakMap,e6=new WeakMap,e4=e=>e6.get(e),e9=e=>!!eO.get(e)&&e3.get(e);function e5(e,t,n){let r={...n};if("insert"===t.type&&1===t.path.length)return[e7(e,t,n,t.items.length)];if("unset"===t.type&&1===t.path.length)return[e7(e,t,n,-1)];if("unset"===t.type&&0===t.path.length)return e1("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[n];if("diffMatchPatch"===t.type){let i=e.children.findIndex(e=>T()({_key:e._key},t.path[0])),l=e.children[i];if(M.W_.isElement(l)&&Array.isArray(l.children)){let e=l.children.findIndex(e=>T()({_key:e._key},t.path[2])),a=e2.patch_fromText(t.value)[0];if(!a)return e1("Could not parse diffMatchPatch",t),[n];let o=a.length2-a.length1,s=a.diffs.some(e=>-1===e[0]);if("split_node"===n.type&&n.path.length>1){let e=r;return s?e.position-=o:e.position+=o,[e]}if(("insert_text"===n.type||"remove_text"===n.type)&&M.y$.isPath(n.path)&&void 0!==n.path[0]&&n.path[0]===i&&n.path[1]===e){if("insert_text"===n.type){let e=0;for(let t of a.diffs)if(0===t[0]&&(e=t[1].length),1===t[0])break;if(null!==a.start1&&e+a.start1<=n.offset){let e=r;e.offset+=o,r=e}return[r]}if("remove_text"===n.type){let e=0;for(let t of a.diffs)if(0===t[0]&&(e=t[1].length),-1===t[0])break;if(null!==a.start1&&e+a.start1<=n.offset){let e=r;e.offset-=o,r=e}return[r]}}}}return[n]}function e7(e,t,n,r){let i=e.children.findIndex(e=>T()({_key:e._key},t.path[0]));if(i>=0&&"set_selection"!==n.type&&Array.isArray(n.path)&&void 0!==n.path[0]&&n.path[0]>=i+r){let e={...n},i=[n.path[0]+r,...n.path.slice(1)];return e1("Adjusting ".concat(n.type," for block ").concat(t.type),n.path,i),e.path=i,e}return n}let e8=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&M.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&M.y$.equals(e.path,t.path)),te=(e,t)=>"set_selection"!==e.type||null!==e.newProperties,tt=(e,t)=>!!t&&"set_selection"===e.type&&"set_selection"===t.type,tn=e=>"set_selection"!==e.type;function tr(e,t){let n=e9(e);e3.set(e,!1),t(),e3.set(e,n)}let ti=el("plugin:withPatches"),tl=el("plugin:withPlaceholderBlock"),ta=el("plugin:withPortableTextBlockStyle"),to=el("plugin:withPortableTextLists"),ts=el("plugin:withPortableTextMarkModel"),tc=el("plugin:withPortableTextSelections"),th=el("plugin:withSchemaTypes"),tf=el("plugin:withUtils"),tp=el("plugin:withHotKeys"),td={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function tu(e,t,n){let r=null,i=!0,l=[t.span.name,...t.inlineObjects.map(e=>e.name)],a=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null}:Array.isArray(e)&&0!==e.length?(e.some((e,o)=>{if(!Y()(e))return r={patches:[eA([o])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e},!0;if(!e._key)return r={patches:[eD({...e,_key:n()},[o])],description:"Block at index ".concat(o," is missing required _key."),action:"Set the block with a random _key value",item:e},!0;if(!e._type||!a.includes(e._type)){if("block"===e._type){let n=t.block.name;return r={patches:[eD({...e,_type:n},[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(n,"'"),action:"Use type '".concat(n,"'"),item:e},!0}return r={patches:[eA([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e},!0}if(e._type===t.block.name){if(!e.children)return r={patches:[eA([{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' is missing required key 'children'."),action:"Remove the block",item:e},!0;if(!e.markDefs)return r={patches:[eD({...e,markDefs:[]},[{_key:e._key}])],description:"Block is missing required key 'markDefs'.",action:"Add empty markDefs array",item:e},!0;let a=Z()(B()(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[]))),o=a.filter(e=>!t.decorators.map(e=>e.value).includes(e)),s=o.filter(t=>!!e.markDefs&&!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n)return r={patches:n.map(t=>eD((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(s.join(", "),") not supported by the current content model."),action:"Remove invalid marks",item:e},!0}if(e.children&&0===e.children.length){let i={_type:t.span.name,_key:n(),text:""};return r={patches:[eN([i],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e},!0}e.children.some((i,a)=>{if(!i._key){let t={...i,_key:n()};return r={patches:[eD(t,[{_key:e._key},"children",a])],description:"Child at index ".concat(a," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e},!0}return i._type&&!1!==l.includes(i._type)?i._type===t.span.name&&void 0===i.text&&(r={patches:[eD({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' is missing text property!"),action:"Write an empty .text to the object",item:e},!0):(r={patches:[eA([{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(i._type,")."),action:"Remove the object",item:e},!0)})&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:r}):{valid:!1,resolution:{patches:[eA([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e}}}let tg=el("plugin:withInsertData"),tm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ty(e,t){if(!e.selection)return!1;let[n,r]=M.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(n)&&e.isTextBlock(t[0])){let{markDefs:i}=n;return tg("Mixing markDefs of focusBlock and fragments[0] block",i,t[0].markDefs),M.YR.setNodes(e,{markDefs:[...t[0].markDefs||[],...i||[]]},{at:r,mode:"lowest",voids:!1}),!0}return!1}let tk=new WeakMap,tv=(e,t)=>{var n;let r=e,{keyGenerator:i,portableTextEditor:l,patches$:a,readOnly:o,maxBlocks:s,isPending:c}=t,{schemaTypes:h,change$:y}=l;r.subscriptions=[],r.destroy?r.destroy():tk.set(r,{apply:r.apply,onChange:r.onChange,normalizeNode:r.normalizeNode});let k=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,r){let i=r[n.path[0]];if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=r[n.path[0]-1],a=0===n.path[0]?null==i?void 0:i._key:null==l?void 0:l._key;return a?[eN([eb([n.node],t)[0]],e,[{_key:a}])]:[eM(r,[]),eN([eb([n.node],t)[0]],"before",[n.path[0]])]}if(2===n.path.length&&e.children[n.path[0]]){if(!e.isTextBlock(i))throw Error("Invalid block");let r=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",l=eb([{_key:"bogus",_type:t,children:[n.node]}],t)[0],a=l.children[0];return[eN([a],r,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)," - ").concat(JSON.stringify(r)))},insertTextPatch:function(e,t,n){eC("Operation",JSON.stringify(t,null,2));let r=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&e.isTextSpan(r.children[t.path[1]])&&r.children[t.path[1]];if(!i)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:i._key},"text"],a=n[t.path[0]],o=e.isTextBlock(a)&&a.children[t.path[1]],s=e.isTextSpan(o)?o.text:"",c=eT(s,i.text,l);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,r){let i=[];if(1===n.path.length){let l=r[n.path[0]],a=l&&l._key;if(a){let r=eb([e.children[n.path[0]-1]],t)[0];i.push(eD(r,[{_key:r._key}])),i.push(eA([{_key:a}]))}else throw Error("Target key not found!")}else if(2===n.path.length){let t=r[n.path[0]],l=e.isTextBlock(t)&&t.children[n.path[1]]||void 0,a=e.children[n.path[0]];if(!e.isTextBlock(a))throw Error("Invalid block");let o=a.children[n.path[1]-1];e.isTextSpan(o)&&(i.push(eD(o.text,[{_key:t._key},"children",{_key:o._key},"text"])),l&&i.push(eA([{_key:t._key},"children",{_key:l._key}])))}else throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)));return i},moveNodePatch:function(e,n,r){let i=[],l=r[n.path[0]],a=r[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";i.push(eA([{_key:l._key}])),i.push(eN([eb([l],t)[0]],e,[{_key:a._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(a)){let e=l.children[n.path[1]],r=a.children[n.newPath[1]],o=n.newPath[1]===a.children.length?"after":"before",s=eb([l],t)[0].children[n.path[1]];i.push(eA([{_key:l._key},"children",{_key:e._key}])),i.push(eN([s],o,[{_key:a._key},"children",{_key:r._key}]))}return i},removeNodePatch:function(e,t,n){let r=n[t.path[0]];if(1===t.path.length){if(r&&r._key)return[eA([{_key:r._key}])];throw Error("Block not found")}if(2===t.path.length){let n=e.isTextBlock(r)&&r.children&&r.children[t.path[1]];return n?[eA([{_key:r._key},"children",{_key:n._key}])]:(eC("Span not found in editor trying to remove node"),[])}throw Error("Unexpected path encountered: ".concat(JSON.stringify(t.path)))},removeTextPatch:function(e,t,n){let r=e&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&r.children[t.path[1]]||void 0,l=e.isTextSpan(i)?i:void 0;if(i&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let a=[{_key:r._key},"children",{_key:l._key},"text"],o=n[t.path[0]],s=e.isTextBlock(o)&&o.children[t.path[1]],c=e.isTextSpan(s)&&s.text,h=eT(c||"",l.text,a);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let r=e.children[n.path[0]];if("string"!=typeof r._key)throw Error("Expected block to have a _key");let i=C()({...e.children[n.path[0]],...n.newProperties},S());return[eD(eb([i],t)[0],[{_key:r._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let r=t._key,i=e._key,l=[];return Object.keys(n.newProperties).forEach(e=>{let t=R()(n.newProperties,e);l.push(eD(t,[{_key:r},"children",{_key:i},e]))}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))},splitNodePatch:function(e,n,r){let i=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let a=r[n.path[0]];if(e.isTextBlock(a)){let r=eb([e.children[n.path[0]+1]],t)[0];if(r){i.push(eN([r],"after",[{_key:l._key}]));let e=a.children.slice(n.position);e.forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];i.push(eA(t))})}}return i}if(2===n.path.length){let r=l.children[n.path[1]];if(e.isTextSpan(r)){let e=eb([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;i.push(eN(e,"after",[{_key:l._key},"children",{_key:r._key}])),i.push(eD(r.text,[{_key:l._key},"children",{_key:r._key},"text"]))}}return i}}}(h),_=function(e){eB.set(e,!1);let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if("split_node"===n.type&&(n.properties={...n.properties,_key:i()}),"insert_node"===n.type){let t=!eB.get(e)||!("_key"in n.node);M.ML.isEditor(n.node)||(n.node={...n.node,...t?{_key:i()}:{}})}t(n)},e.normalizeNode=t=>{let[r,l]=t;if(M.W_.isElement(r)&&r._type===h.block.name){for(let[t,n]of(r._key||M.YR.setNodes(e,{_key:i()},{at:l}),M.NB.children(e,l)))if(!t._key){M.YR.setNodes(e,{_key:i()},{at:n});return}}n(t)},e},b=function(e){e.isTextBlock=e=>(0,j.DG)(e)&&e._type===h.block.name,e.isTextSpan=e=>(0,j.NG)(e)&&e._type==h.span.name,e.isListBlock=e=>(0,j.KA)(e)&&e._type===h.block.name,e.isVoid=e=>h.block.name!==e._type&&(h.blockObjects.map(e=>e.name).includes(e._type)||h.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>{let t=h.inlineObjects.map(e=>e.name);return t.includes(e._type)&&"__inline"in e&&!0===e.__inline};let{apply:t}=e;return e.apply=e=>{let n="insert_node"===e.type&&2===e.path.length&&M.xv.isText(e.node)&&void 0===e.node._type;if(n){let t={...e.node,_type:"span"};e.node=t,th("Setting span type to child without a type",e)}t(e)},e},x=function(e){return l.setEditable({focus:()=>{if(!e.selection){let t={path:[0,0],offset:0};M.YR.select(e,{focus:t,anchor:t}),e.onChange()}w.F3.focus(e)},blur:()=>{w.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...M.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=eR(t,e);n?M.YR.select(e,n):M.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection)try{let[t]=Array.from(M.ML.nodes(e,{at:e.selection.focus,match:t=>M.ML.isBlock(e,t)}))[0]||[void 0];if(t)return eb([t],h.block.name,em.get(e))[0]}catch(e){}},focusChild:()=>{if(e.selection)try{let[t]=Array.from(M.ML.nodes(e,{mode:"lowest",at:e.selection.focus,match:e=>void 0!==e._type,voids:!0}))[0]||[void 0];if(t&&!M.ML.isBlock(e,t)){let n={_key:"pseudo",_type:h.block.name,children:[t]},r=eb([n],h.block.name,em.get(e));if(e.isTextBlock(r[0]))return r[0].children[0]}}catch(e){}},insertChild:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let[a]=Array.from(M.ML.nodes(e,{at:e.selection.focus,match:t=>M.ML.isBlock(e,t)}))[0]||[void 0];if(!a)throw Error("No focus block");if(a&&M.ML.isVoid(e,a))throw Error("Can't insert childs into block objects");let o=e_([{_key:i(),_type:h.block.name,children:[{_key:i(),_type:t.name,...n||{}}]}],l)[0],s=o.children[0];return M.ML.insertNode(e,s),e.onChange(),(null==(r=eP(eb(e.children,h.block.name,em.get(e)),e.selection,h))?void 0:r.focus.path)||[]},insertBlock:(t,n)=>{var r;if(!e.selection)throw Error("The editor has no selection");let a=e_([{_key:i(),_type:t.name,...n||{}}],l)[0];return M.ML.insertNode(e,a),e.onChange(),(null==(r=eP(eb(e.children,h.block.name,em.get(e)),e.selection,h))?void 0:r.focus.path)||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch(e){return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch(e){return!1}},isVoid:e=>![h.block.name,h.span.name].includes(e._type),findByPath:t=>{let n=eR({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[r,i]=M.ML.node(e,n.focus.path.slice(0,1));if(r&&i&&"string"==typeof r._key){if(1===t.length&&1===n.focus.path.length)return[eb([r],h.block.name)[0],[{_key:r._key}]];let i=eb([r],h.block.name,em.get(e))[0];if(e.isTextBlock(i)){let e=i.children[n.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[r]=Array.from(M.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=w.F3.toDOMNode(e,r)}catch(e){}return n},activeAnnotations:()=>{var t;if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[],r=M.ML.nodes(e,{at:e.selection,match:e=>M.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0});for(let[i,l]of r){let[r]=M.ML.node(e,l,{depth:1});e.isTextBlock(r)&&(null==(t=r.markDefs)||t.forEach(e=>{M.xv.isText(i)&&i.marks&&Array.isArray(i.marks)&&i.marks.includes(e._key)&&n.push(e)}))}return n}catch(e){return[]}},addAnnotation:(t,n)=>{let{selection:r}=e;if(r){let[l]=M.ML.node(e,r.focus,{depth:1});if(M.W_.isElement(l)&&l._type===h.block.name){let a=i();if(e.isTextBlock(l)){M.YR.setNodes(e,{markDefs:[...l.markDefs||[],{_type:t.name,_key:a,...n}]},{at:r.focus}),e.onChange(),M.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange());let[o]=M.ML.node(e,r.focus,{depth:2});if(e.selection){M.ML.withoutNormalizing(e,()=>{M.YR.setNodes(e,{},{match:M.xv.isText,split:!0}),e.selection&&M.xv.isText(o)&&(M.YR.setNodes(e,{marks:[...o.marks||[],a]},{at:e.selection,match:e=>e._type===h.span.name}),e.onChange())}),M.ML.normalize(e),e.onChange();let t=eP(eb(e.children,h.block.name,em.get(e)),e.selection,h);if(t&&"string"==typeof l._key)return M.ML.withoutNormalizing(e,()=>{e.selection&&(M.YR.insertNodes(e,[{_type:"span",text:"",marks:[],_key:i()}],{at:M.e6.end(e.selection)}),e.onChange())}),{spanPath:t.focus.path,markDefPath:[{_key:l._key},"markDefs",{_key:a}]}}}}}},delete:(t,n)=>{if(t){let r=eR(t,e);if(r){if(!(null==n?void 0:n.mode)||(null==n?void 0:n.mode)==="selected"){eI("Deleting content in selection"),M.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}let t=M.ML.nodes(e,{at:r,match:t=>(null==n?void 0:n.mode)==="blocks"?(eI("Deleting blocks touched by selection"),e.isTextBlock(t)||!e.isTextBlock(t)&&M.W_.isElement(t)):(eI("Deleting children touched by selection"),t._type===h.span.name||!e.isTextBlock(t)&&M.W_.isElement(t))}),i=[...t];i.forEach(t=>{let[,n]=t;M.YR.removeNodes(e,{at:n,voids:!0,hanging:!0})}),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(eI("Removing annotation",t),n){if(M.e6.isCollapsed(n)){let[t,r]=M.ML.node(e,n,{depth:2});M.xv.isText(t)&&t.marks&&"string"==typeof t.text&&(M.YR.select(e,r),n=e.selection)}M.ML.withoutNormalizing(e,()=>{if(n&&M.e6.isExpanded(n)){if(!(n=e.selection))return;M.YR.setNodes(e,{},{match:M.xv.isText,split:!0}),e.onChange();let r=[...M.ML.nodes(e,{at:n,match:e=>M.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})];r.forEach(n=>{var r;let[i,l]=n,[a]=M.ML.node(e,l,{depth:1});e.isTextBlock(a)&&(null==(r=a.markDefs)||r.filter(e=>e._type===t.name).forEach(t=>{if(M.xv.isText(i)&&Array.isArray(i.marks)&&i.marks.includes(t._key)){let n=[...(i.marks||[]).filter(e=>e!==t._key)];M.YR.setNodes(e,{marks:n},{at:l,voids:!1,split:!1})}}))})}}),M.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=ey.get(e.selection);if(n)return n;t=eP(eb(e.children,h.block.name,em.get(e)),e.selection,h),ey.set(e.selection,t)}return t},getValue:()=>eb(e.children,h.block.name,em.get(e)),isCollapsedSelection:()=>!!e.selection&&M.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&M.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()}}),e},E=function(e){let t,n,{change$:r,isPending:i,patches$:l,patchFunctions:a,readOnly:o,schemaTypes:s}=e,c=function(e,n){let r=!1;eG("\n\nNEW PATCH ============================================================="),eG(JSON.stringify(n,null,2));try{switch(n.type){case"insert":r=function(e,t){if(1===t.path.length){let{items:n,position:r}=t,i=e_(n,{schemaTypes:s},eg.get(e)),l=eQ(t.path),a=Math.max(0,e.children.findIndex((e,n)=>l?e._key===l:n===t.path[0])),o="after"===r?a+1:a;return eG("Inserting blocks at path [".concat(o,"]")),e0(e,"before"),M.YR.insertNodes(e,i,{at:[o]}),e0(e,"after"),!0}let{items:n,position:r}=t,i=eQ(t.path),l=e.children.findIndex((e,n)=>i?e._key===i:n===t.path[0]),a=e.children&&l>-1?e.children[l]:void 0,o=e.isTextBlock(a)?a.children.findIndex((e,n)=>eX(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,c=a&&e_([{...a,children:n}],{schemaTypes:s},eg.get(e)),h=[l,"after"===r?o+1:o];return eG("Inserting children at path ".concat(h)),e0(e,"before"),c&&M.W_.isElement(c[0])&&M.YR.insertNodes(e,c[0].children,{at:h}),e0(e,"after"),!0}(e,n);break;case"unset":r=function(e,t,n){var r;if(0===t.path.length)return eG("Removing everything"),e0(e,"before"),M.YR.deselect(e),e.children.forEach((t,n)=>{M.YR.removeNodes(e,{at:[n]})}),e0(e,"after"),!0;if(1===t.path.length){let n=eQ(t.path),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]);if(-1===r)return eG("Could not find block to unset at path ".concat(JSON.stringify(t.path))),!1;if(eG("Removing block at path [".concat(r,"]")),e0(e,"before"),e.selection&&e.selection.focus.path[0]===r&&e.children[r-1]){let t={path:[Math.max(e.selection.focus.path[0]-1,0)],offset:0};M.YR.select(e,{focus:t,anchor:t}),M.YR.move(e,{unit:"line"})}return M.YR.removeNodes(e,{at:[r]}),e0(e,"after"),!0}let i=e.children.findIndex((e,n)=>eX(t.path[0])?e._key===t.path[0]._key:n===t.path[0]),l=i>-1?e.children[i]:void 0;if(e.isTextBlock(l)&&"children"===t.path[1]&&3===t.path.length){let a=l.children.findIndex((e,n)=>eX(t.path[2])?e._key===t.path[2]._key:n===t.path[2]),o=[i,a],s=e.selection&&{...e.selection},c=T()(null==(r=e.selection)?void 0:r.focus.path,o);if(-1===a)return eG("Could not find child to unset at path ".concat(JSON.stringify(o))),!1;if(eG("Unsetting child at path ".concat(JSON.stringify(o))),e0(e,"before"),s&&c&&e.isTextBlock(l)){let t=a>=s.focus.path[1];if(t){let t=l.children[a],r=(null==n?void 0:n.type)==="set"&&"text"===n.path[3]&&"string"==typeof n.value&&e.isTextSpan(t)&&T()(n.value.slice(-t.text.length),l.children[a].text);if(r){let n=l.children[Math.max(a-1,0)];return eG("Adjusting selection for merging of nodes"),s.focus={...s.focus},s.focus.path=[o[0],Math.max(o[1]-1,0)],s.focus.offset=e.isTextSpan(n)?n.text.length-t.text.length+s.focus.offset:0,s.anchor=s.focus,M.YR.select(e,s),M.YR.removeNodes(e,{at:[i,a]}),e0(e,"after"),!0}}}return M.YR.removeNodes(e,{at:[i,a]}),e0(e,"after"),!0}if(!e.isTextBlock(l)){let n=[t].reduce(eZ,[l])[0];return M.YR.setNodes(e,n,{at:[i]}),!0}return!1}(e,n,t);break;case"set":r=function(e,t){let n=e.children.findIndex((e,n)=>eX(t.path[0])?e._key===t.path[0]._key:n===t.path[0]);eG("blockIndex",n);let r=n>-1?e.children[n]:void 0,i=e.isTextBlock(r)?r.children.findIndex((e,n)=>eX(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,l=t.value,a=i>-1?[n,i]:[n];"string"==typeof t.path[3]&&((l={})[t.path[3]]=t.value);let o=e.isTextBlock(r);if(o){if(eG("Setting nodes at ".concat(JSON.stringify(t.path)," - ").concat(JSON.stringify(a))),eG("Value to set",JSON.stringify(l,null,2)),e0(e,"before"),1===a.length){eG("Setting block property");let{children:t,...n}=l,{children:i,...o}=r||{children:void 0};e.apply({type:"set_node",path:a,properties:{...o},newProperties:n}),r&&M.W_.isElement(r)&&r.children.forEach((t,n)=>{e.apply({type:"remove_node",path:a.concat(n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:a.concat(n),node:t})})}else if(M.xv.isText(l)){eG("Setting text property");let t=e.selection&&{...e.selection};e.apply({type:"remove_text",path:a,offset:0,text:r.children[i].text}),e.apply({type:"insert_text",path:a,offset:0,text:l.text});let n=t&&T()(t.focus.path,a);n&&(eG("On same path, restoring previous selection"),M.YR.select(e,t))}else eG("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:l});return e0(e,"after"),!0}if(r&&"value"in r){var s;let i=(s=[r.value],[t].reduce(eZ,s))[0];return M.YR.setNodes(e,{...r,value:i},{at:[n]}),!0}return!1}(e,n);break;case"diffMatchPatch":r=function(e,t){let n=eQ([t.path[0]]),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]),i=e.children[r],l=eK.patch_fromText(t.value)[0];if(l&&e.isTextBlock(i)){let n;let a=eQ([t.path[2]]),o=i.children.findIndex((e,n)=>a?e._key===a:n===t.path[0]),s=l.length2-l.length1,c={path:[r,o],offset:s>=0?(l.start1||0)+l.diffs[0][1].length:(l.start2||0)+l.length2-s};return e0(e,"before"),n=l.diffs[1]?l.diffs[1][1]:l.diffs[0][1],eG("Text: '".concat(n,"'")),s>=0?e.apply({type:"insert_text",path:c.path,offset:c.offset,text:n}):e.apply({type:"remove_text",path:c.path,offset:c.offset-n.length,text:n}),e0(e,"after"),!0}return!1}(e,n);break;default:eG("Unhandled patch",n.type)}}catch(e){console.error(e)}return t=n,r};return function(e){eO.set(e,!0),n=[...e.children];let{apply:t}=e;return l&&e.subscriptions.push(()=>{var t;ti("Subscribing to patches$");let n=l.pipe((0,p.b)(e=>{let{patches:t}=e;t.every(e=>"local"===e.origin)&&(i.current=!1)}),(t=()=>!i.current,e=>(0,f.P)(()=>{let n=[];return e.pipe((0,p.b)(e=>n.push(e)),(0,d.w)(()=>t(n)?(0,u.of)(n):g.E),(0,p.b)(()=>n=[]))})),(0,m.b)(e=>e)).subscribe(t=>{let{patches:n,snapshot:r}=t,i=n.filter(e=>"local"!==e.origin);0!==i.length&&(ti("Remote patches",n),M.ML.withoutNormalizing(e,()=>{i.forEach(t=>{ti("Handling remote patch ".concat(JSON.stringify(t))),eY(e,()=>{tr(e,()=>{ej(e,()=>{try{c(e,t,n,r)}catch(e){ti("Got error trying to create operations from patch"),console.error(e)}})})})})}))});return()=>{ti("Unsubscribing to patches$"),n.unsubscribe()}}),e.apply=i=>{if(o)return t(i),e;let l=[];n=e.children;let c=ex(n,s);t(i);let h=ex(e.children,s);if(!eO.get(e))return ti("Editor is not producing patch for operation ".concat(i.type),i),e;switch(c&&!h&&(l.push(eA([])),l.push(eM([],[])),n.forEach((e,t)=>{l.push(eN(eb([e],s.block.name),"before",[t]))})),h&&["set_node"].includes(i.type)&&l.push(eA([])),i.type){case"insert_text":l=[...l,...a.insertTextPatch(e,i,n)];break;case"remove_text":l=[...l,...a.removeTextPatch(e,i,n)];break;case"remove_node":l=[...l,...a.removeNodePatch(e,i,n)];break;case"split_node":l=[...l,...a.splitNodePatch(e,i,n)];break;case"insert_node":l=[...l,...a.insertNodePatch(e,i,n)];break;case"set_node":l=[...l,...a.setNodePatch(e,i,n)];break;case"merge_node":l=[...l,...a.mergeNodePatch(e,i,n)];break;case"move_node":l=[...l,...a.moveNodePatch(e,i,n)]}return h&&["remove_text","remove_node"].includes(i.type)&&(l=[...l,eA([])],r.next({type:"unset",previousValue:eb(n,s.block.name,em.get(e))})),l.length>0&&l.forEach(e=>{r.next({type:"patch",patch:{...e,origin:"local"}})}),e},e}}({change$:y,isPending:c,keyGenerator:i,patches$:a,patchFunctions:k,readOnly:o,schemaTypes:h}),N=(n=s||-1,function(e){let{apply:t}=e;return e.apply=r=>{n>0&&e.children.length>=n&&("insert_node"===r.type||"split_node"===r.type)&&1===r.path.length||t(r)},e}),A=function(e){return e.pteToggleListItem=t=>{let n=e.pteHasListStyle(t);n?(to("Remove list item '".concat(t,"'")),e.pteUnsetListItem(t)):(to("Add list item '".concat(t,"'")),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{if(!e.selection)return;let n=[...M.ML.nodes(e,{at:e.selection,match:e=>M.W_.isElement(e)&&e._type===h.block.name})];n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let{listItem:n,level:l,...a}=r,o={...a,listItem:void 0,level:void 0};to("Unsetting list '".concat(t,"'")),M.YR.setNodes(e,o,{at:i})}})},e.pteSetListItem=t=>{if(!e.selection)return;let n=[...M.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];n.forEach(n=>{let[r,i]=n;to("Setting list '".concat(t,"'")),M.YR.setNodes(e,{...r,level:1,listItem:t||h.lists[0]&&h.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...M.ML.nodes(e,{at:e.selection,match:t=>M.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&M.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(t=>{let[n,r]=t;M.W_.isElement(n)&&(to("Unset list"),M.YR.setNodes(e,{...n,level:void 0,listItem:void 0},{at:r}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...M.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let n=r.level||1;t?to("Decrementing list level",Math.min(10,Math.max(1,--n))):to("Incrementing list level",Math.min(10,Math.max(1,++n))),M.YR.setNodes(e,{level:Math.min(10,Math.max(1,n))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[...M.ML.nodes(e,{at:e.selection,match:n=>e.isListBlock(n)&&n.listItem===t})];return n.length>0},e},L=function(e){let{readOnly:t,patches$:n}=e,r=[];return e=>{n&&e.subscriptions.push(()=>{e1("Subscribing to patches");let e=n.subscribe(e=>{let{patches:t}=e;t.forEach(e=>{"local"!==e.origin&&r.push({patch:e,time:new Date})})});return()=>{e1("Unsubscribing to patches"),e.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:i}=e;return e.apply=n=>{if(t){i(n);return}let{operations:r,history:l}=e,{undos:a}=l,o=a[a.length-1],s=o&&o.operations&&o.operations[o.operations.length-1],c=tt(n,s),h=e9(e),f=e4(e);if(null==h&&(h=te(n)),h){if(null==f&&(f=null!=o&&(0!==r.length||e8(n,s)||c)),o&&f)c&&o.operations.pop(),o.operations.push(n);else{let t={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],n],timestamp:new Date};a.push(t),e1("Created new undo step",o)}for(;a.length>300;)a.shift();tn(n)&&(l.redos=[])}i(n)},e.undo=()=>{if(t)return;let{undos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(e1("Undoing",t),t.operations.length>0){let n=[...r.filter(e=>e.time>=t.timestamp)],i=t.operations;n.forEach(t=>{i=B()(i.map(n=>e5(e,t.patch,n)))}),tr(e,()=>{M.ML.withoutNormalizing(e,()=>{i.map(M.OX.inverse).reverse().forEach(n=>{try{e.apply(n)}catch(n){e1("Could not perform undo step",n),e.history.redos.push(t),e.history.undos.pop()}})})})}e.history.redos.push(t),e.history.undos.pop(),e.onChange()}},e.redo=()=>{if(t)return;let{redos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(e1("Redoing",t),t.operations.length>0){let n=r.filter(e=>e.time>t.timestamp),i=t.operations;n.forEach(t=>{i=B()(i.map(n=>e5(e,t.patch,n)))}),tr(e,()=>{M.ML.withoutNormalizing(e,()=>{i.forEach(n=>{try{e.apply(n)}catch(n){e1("Could not perform redo step",n),e.history.undos.push(t),e.history.redos.pop()}})})})}e.history.undos.push(t),e.history.redos.pop(),e.onChange()}},e}}({readOnly:o,patches$:a}),P=function(e){let{apply:t,normalizeNode:n}=e,r=h.decorators.map(e=>e.value);return e.normalizeNode=t=>{n(t),e.operations.some(e=>["insert_node","insert_text","merge_node","remove_node","remove_text","set_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t)for(let[n,r]of Array.from(M.ML.nodes(e,{at:M.ML.range(e,[t.anchor.path[0]],[t.focus.path[0]])})).reverse()){let[t]=r.length>1?M.ML.node(e,M.y$.parent(r)):[void 0],i=[r[0],r[1]+1];if(M.ML.isBlock(e,t)){let r=t.children[i[1]];M.xv.isText(n)&&M.xv.isText(r)&&T()(r.marks,n.marks)&&(ts("Merging spans"),M.YR.mergeNodes(e,{at:i,voids:!0}),e.onChange())}}}(e);let[r,i]=t,l=M.xv.isText(r)&&r._type===h.span.name,a=e.isTextBlock(r);if(l||a){for(let t of(a||Array.isArray(r.marks)||(ts("Adding .marks to span node"),M.YR.setNodes(e,{marks:[]},{at:i}),e.onChange()),e.operations)){if("merge_node"===t.type&&1===t.path.length&&"markDefs"in t.properties&&t.properties._type===h.block.name&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]-1>=0){let[n,r]=M.ML.node(e,[t.path[0]-1]);if(ts("Copying markDefs over to merged block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[],l=Z()([...i,...t.properties.markDefs]),a=T()(l,n.markDefs);a||(M.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),e.onChange())}}if("split_node"===t.type&&1===t.path.length&&M.W_.isElementProps(t.properties)&&t.properties._type===h.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0&&t.path[0]+1<e.children.length){let[n,r]=M.ML.node(e,[t.path[0]+1]);if(ts("Copying markDefs over to split block",t),e.isTextBlock(n)){let i=Array.isArray(n.markDefs)&&n.markDefs||[];M.YR.setNodes(e,{markDefs:Z()([...i,...t.properties.markDefs])},{at:r,voids:!1}),e.onChange()}}if("split_node"===t.type&&2===t.path.length&&t.properties._type===h.span.name&&"marks"in t.properties&&Array.isArray(t.properties.marks)&&t.properties.marks.length>0&&t.path[0]+1<e.children.length){let[n,r]=M.ML.node(e,[t.path[0]+1,0]);M.xv.isText(n)&&""===n.text&&Array.isArray(n.marks)&&n.marks.length>0&&(M.YR.setNodes(e,{marks:[]},{at:r,voids:!1}),e.onChange())}if("split_node"===t.type&&1===t.path.length&&t.properties._type===h.block.name&&"markDefs"in t.properties&&Array.isArray(t.properties.markDefs)&&t.properties.markDefs.length>0){let[n,r]=M.ML.node(e,[t.path[0]]);e.isTextBlock(n)&&1===n.children.length&&n.markDefs&&n.markDefs.length>0&&M.xv.isText(n.children[0])&&""===n.children[0].text&&(!n.children[0].marks||0===n.children[0].marks.length)&&(M.YR.setNodes(e,{markDefs:[]},{at:r}),e.onChange())}}l&&Array.isArray(r.marks)&&r.marks.length>0&&""===r.text&&(M.YR.setNodes(e,{marks:[]},{at:i,voids:!1}),e.onChange())}a&&e.operations.some(e=>["split_node","remove_node","remove_text","merge_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t){let n=M.ML.nodes(e,{at:t,match:e=>e._type===h.block.name});for(let[t,r]of n)if(e.isTextBlock(t)){let n=(t.markDefs||[]).filter(e=>t.children.find(t=>M.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));T()(n,t.markDefs)||(ts("Removing markDef not in use"),M.YR.setNodes(e,{markDefs:n},{at:r}),e.onChange())}}}(e)},e.apply=n=>{var i,l;if("insert_text"===n.type){let{selection:a}=e;if(a&&M.e6.isCollapsed(a)&&(null==(l=null==(i=M.ML.marks(e))?void 0:i.marks)?void 0:l.some(e=>!r.includes(e)))){let[i]=Array.from(M.ML.nodes(e,{mode:"lowest",at:a.focus,match:e=>e._type===h.span.name,voids:!1}))[0]||[void 0];if(M.xv.isText(i)&&i.text.length===a.focus.offset&&Array.isArray(i.marks)&&i.marks.length>0){t(n),M.YR.splitNodes(e,{match:M.xv.isText,at:{...a.focus,offset:a.focus.offset}});let i=(({...M.ML.marks(e)||{}}).marks||[]).filter(e=>r.includes(e));M.YR.setNodes(e,{marks:i},{at:M.y$.next(a.focus.path)});return}}}t(n)},e.addMark=t=>{if(e.selection){if(M.e6.isExpanded(e.selection)){M.YR.setNodes(e,{},{match:M.xv.isText,split:!0});let n=[...M.ML.nodes(e,{at:e.selection,match:M.xv.isText})],r=B()(n.map(e=>e[0]).map(e=>e.marks)).includes(t);if(r){e.removeMark(t);return}M.ML.withoutNormalizing(e,()=>{n.forEach(n=>{let[r,i]=n,l=[...(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),t];M.YR.setNodes(e,{marks:l},{at:i,match:M.xv.isText,split:!0,hanging:!0})})}),M.ML.normalize(e)}else{let n={...M.ML.marks(e)||{}}.marks||[],r={...M.ML.marks(e)||{},marks:[...n,t]};e.marks=r}e.onChange()}},e.removeMark=t=>{let{selection:n}=e;if(n){if(M.e6.isExpanded(n))M.ML.withoutNormalizing(e,()=>{if(M.YR.setNodes(e,{},{match:M.xv.isText,split:!0}),e.selection){let n=[...M.ML.nodes(e,{at:e.selection,match:M.xv.isText})];n.forEach(n=>{let[r,i]=n,l=e.children[i[0]];M.W_.isElement(l)&&l.children.includes(r)&&M.YR.setNodes(e,{marks:(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t)},{at:i})})}}),M.ML.normalize(e);else{let n={...M.ML.marks(e)||{}}.marks||[],r={...M.ML.marks(e)||{},marks:n.filter(e=>e!==t)};e.marks=r}e.onChange()}},e.pteIsMarkActive=t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;let n={...M.ML.marks(e)||{}}.marks||[];return M.e6.isExpanded(e.selection)&&Array.from(M.ML.nodes(e,{match:M.xv.isText,at:e.selection})).forEach(e=>{let[t]=e;n=Z()([...n,...t.marks||[]])}),n.includes(t)},e.pteToggleMark=t=>{let n=e.pteIsMarkActive(t);n?(ts("Remove mark '".concat(t,"'")),M.ML.removeMark(e,t)):(ts("Add mark '".concat(t,"'")),M.ML.addMark(e,t,!0)),e.onChange()},e},I=function(e,t){let n=e.styles[0].value;return function(r){let{normalizeNode:i}=r;return r.normalizeNode=e=>{i(e);let[,t]=e;for(let e of r.operations)if("split_node"===e.type&&1===e.path.length&&r.isTextBlock(e.properties)&&e.properties.style!==n&&e.path[0]===t[0]&&!M.y$.equals(t,e.path)){let[t]=M.ML.node(r,[e.path[0]+1,0]);if(M.xv.isText(t)&&""===t.text){ta("Normalizing split node to ".concat(n," style"),e),M.YR.setNodes(r,{style:n},{at:[e.path[0]+1],voids:!1});break}}},r.pteHasBlockStyle=e=>{if(!r.selection)return!1;let t=[...M.ML.nodes(r,{at:r.selection,match:t=>r.isTextBlock(t)&&t.style===e})];return t.length>0},r.pteToggleBlockStyle=i=>{if(!r.selection)return;let l=[...M.ML.nodes(r,{at:r.selection,match:t=>M.W_.isElement(t)&&t._type===e.block.name})];l.forEach(e=>{let[t,l]=e;r.isTextBlock(t)&&t.style===i?(ta("Unsetting block style '".concat(i,"'")),M.YR.setNodes(r,{...t,style:n},{at:l})):(i?ta("Setting style '".concat(i,"'")):ta("Setting default style",n),M.YR.setNodes(r,{...t,style:i||n},{at:l}))}),t.next({type:"selection",selection:eP(eb(r.children,e.block.name),r.selection,e)}),r.onChange()},r}}(h,y),O=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){e.createPlaceholderBlock=()=>({_type:t.block.name,_key:n(),style:t.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:n(),text:"",marks:[]}]});let{onChange:r}=e;return e.onChange=()=>{let t=!!e.selection;r(),0===e.children.length&&(tl("Inserting placeholder block"),M.YR.deselect(e),e.children=[e.createPlaceholderBlock()],t&&M.YR.select(e,{focus:{path:[0,0],offset:0},anchor:{path:[0,0],offset:0}}),e.onChange())},e}}({keyGenerator:i,schemaTypes:h}),Y=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.pteExpandToWord=()=>{let{selection:t}=e;if(t&&!M.e6.isExpanded(t)){let[n]=M.ML.node(e,t.focus,{depth:2});if(!n||!M.xv.isText(n)||0===n.text.length){tf("pteExpandToWord: Can't expand to word here");return}let{focus:r}=t,i=r.offset,l=n.text.slice(0,i),a=n.text.slice(i,-1),o=e=>e.match(/\s/g),s=l.split("").reverse().findIndex(e=>o(e)),c=s>-1?l.length-s:0,h=a.split("").findIndex(e=>o(e)),f=l.length+(h>-1?h:a.length+1);if(!(c===f||isNaN(c)||isNaN(f))){tf("pteExpandToWord: Expanding to focused word"),M.YR.setSelection(e,{anchor:{...t.anchor,offset:c},focus:{...t.focus,offset:f}});return}tf("pteExpandToWord: Can't expand to word here")}},e}}({keyGenerator:i,schemaTypes:h}),W=function(e){let t=()=>{let t=null;if(e.selection){let n=ey.get(e.selection);n?t=n:(t=eP(eb(e.children,h.block.name,em.get(e)),e.selection,h),ey.set(e.selection,t))}tc("Emitting selection ".concat(JSON.stringify(t||null))),t?y.next({type:"selection",selection:t}):y.next({type:"selection",selection:null})},{onChange:n}=e;return e.onChange=()=>{let r=e.operations.length>0;n(),r&&t()},e};return(r.destroy=()=>{let e=tk.get(r);if(!e)throw Error("Could not find pristine versions of editor functions");r.onChange=e.onChange,r.apply=e.apply,r.normalizeNode=e.normalizeNode},o)?{editor:b(_(P(I(Y(O(A(W(x(r))))))))),subscribe:()=>D()}:{editor:b(_(P(I(A(O(Y(N(L(E(W(x(r)))))))))))),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},t_=el("component:PortableTextEditor:SlateContainer");function tb(e){let{patches$:t,portableTextEditor:n,readOnly:r,maxBlocks:i,keyGenerator:l,value:a,isPending:o}=e,[s,f]=(0,h.useMemo)(()=>{t_("Creating new Slate editor instance");let{editor:e,subscribe:a}=tv((0,w.BU)((0,M.Jh)()),{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r});return em.set(e,{}),eg.set(e,{}),[e,a]},[]);(0,h.useEffect)(()=>{let e=f();return()=>{e()}},[f]),(0,h.useEffect)(()=>{t_("Re-initializing plugin chain"),tv(s,{isPending:o,keyGenerator:l,maxBlocks:i,patches$:t,portableTextEditor:n,readOnly:r})},[l,n,i,r,t,s,o]);let p=(0,h.useMemo)(()=>a?e_(a,{schemaTypes:n.schemaTypes},eg):[s.createPlaceholderBlock()],[]);return(0,h.useEffect)(()=>()=>{t_("Destroying Slate editor"),s.destroy()},[s]),(0,c.jsx)(w.mH,{editor:s,value:p,children:e.children})}let tx=(0,h.createContext)(null),tw=()=>{let e=(0,h.useContext)(tx);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},tM=(0,h.createContext)(null),tE=()=>{let e=(0,h.useContext)(tM);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},tT=(0,h.createContext)(void 0),tN=(0,h.createContext)(!1),tD=()=>{let e=(0,h.useContext)(tN);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},tA=el("hook:useSyncValue"),tC=el("component:PortableTextEditor:Synchronizer");function tL(e){let{change$:t,editor:n,isPending:r,onChange:i,keyGenerator:l,readOnly:a,value:o}=e,[s,f]=(0,h.useState)(null),p=(0,h.useRef)([]),d=(0,w.ui)(),u=function(e){let{editor:t,slateEditor:n,isPending:r,readOnly:i}=e,l=(0,h.useRef)();return(0,h.useMemo)(()=>(e,a)=>{let o=()=>{n.onChange(),a&&a()};if(r.current&&!i){tA("Has local patches");return}if(l.current===e){tA("Value is the same object");return}if(l.current=e,!e||0===e.length){tA("Value is empty"),o();return}if(e&&e.length>0){let r=e_(e,{schemaTypes:t.schemaTypes},eg.get(n));tr(n,()=>{ej(n,()=>{eY(n,()=>{M.ML.withoutNormalizing(n,()=>{r.length<n.children.length&&Array.from(Array(n.children.length-r.length)).forEach((e,t)=>{M.YR.removeNodes(n,{at:[n.children.length-1-t]})}),r.forEach((e,t)=>{let r=n.children[t];if(r&&!T()(e,r)){tA("Replacing changed block",r);let i=n.selection;M.YR.deselect(n),M.YR.removeNodes(n,{at:[t]}),M.YR.insertNodes(n,e,{at:[t]}),i&&M.YR.select(n,i)}r||(tA("Adding new block",e),M.YR.insertNodes(n,e,{at:[t]}))})})})})})}o()},[t,r,i,n])}({editor:n,keyGenerator:l,isPending:r,readOnly:a,slateEditor:d});(0,h.useEffect)(()=>{(0,h.startTransition)(()=>{tC("Value from props changed, syncing new value"),u(o)}),t.next({type:"value",value:o})},[u,t,o]);let g=(0,h.useCallback)(()=>{let e=[...p.current];tC("Flushing pending patches",e),e.length>0&&(p.current=p.current.splice(e.length,p.current.length),i({type:"mutation",patches:e}))},[i]),m=(0,h.useMemo)(()=>Q()(g,1e3,{leading:!1,trailing:!0}),[g]);return(0,h.useEffect)(()=>()=>{g()},[g]),(0,h.useEffect)(()=>{tC("Subscribing to editor changes$");let e=t.subscribe(e=>{switch(e.type){case"patch":r.current=!0,p.current.push(e.patch),i(e),m();break;case"selection":(0,h.startTransition)(()=>{tC("Setting selection"),f(e.selection)}),i(e);break;default:i(e)}});return()=>{tC("Unsubscribing to changes$"),e.unsubscribe()}},[t,m,i,u,r]),(0,c.jsx)(eo.Provider,{value:l,children:(0,c.jsx)(tM.Provider,{value:n,children:(0,c.jsx)(tT.Provider,{value:o,children:(0,c.jsx)(tN.Provider,{value:a,children:(0,c.jsx)(tx.Provider,{value:s,children:e.children})})})})})}let tS=el("component:PortableTextEditor:Validator");function tP(e){let{portableTextEditor:t,keyGenerator:n,value:r}=e,{change$:i,schemaTypes:l}=t,a=(0,h.useRef)(),[o,s]=(0,h.useState)(null);return((0,h.useEffect)(()=>{let e=r&&a.current&&r.length>a.current.length,t=!a.current&&r;if(t||e){tS("Validating"),i.next({type:"loading",isLoading:!0});let e=tu(r,l,n);i.next({type:"loading",isLoading:!1}),r&&!e.valid&&(i.next({type:"invalidValue",resolution:e.resolution,value:r}),s(e.resolution))}a.current=r},[n,i,l,r]),o)?(0,c.jsx)(c.Fragment,{children:o.description}):(0,c.jsx)(c.Fragment,{children:e.children})}let tR=el("component:PortableTextEditor");class tI extends h.Component{constructor(e){if(super(e),this.change$=new y.x,this.setEditable=e=>{this.editable={...this.editable,...e},this.change$.next({type:"loading",isLoading:!1}),this.change$.next({type:"ready"}),this.change$.next({type:"value",value:this.props.value})},!e.schemaType)throw Error('PortableTextEditor: missing "type" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.change$.next({type:"loading",isLoading:!0}),this.isPending=(0,h.createRef)(),this.isPending.current=!1,this.schemaTypes=er(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:en(e.schemaType))}componentDidUpdate(e){this.props.schemaType!==e.schemaType&&(this.schemaTypes=er(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:en(this.props.schemaType)))}render(){let{onChange:e,value:t,children:n,patches$:r,incomingPatches$:i}=this.props,{change$:l,isPending:a}=this,o=void 0===this.props.maxBlocks?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,s=Boolean(this.props.readOnly),h=this.props.keyGenerator||ea;return(0,c.jsx)(tP,{portableTextEditor:this,keyGenerator:h,value:t,children:(0,c.jsx)(tb,{keyGenerator:h,maxBlocks:o,patches$:i||r,portableTextEditor:this,readOnly:s,value:t,isPending:a,children:(0,c.jsx)(tL,{change$:l,editor:this,isPending:a,keyGenerator:h,onChange:e,readOnly:s,value:t,children:n})})})}}function tB(e,t){if(!e||!t)return null;let n=[],r=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,a=t.find(e=>e._key===i);if(!a)return null;if(n.push({_key:a._key}),a&&"children"===e.path[1]){if(!a.children||Array.isArray(a.children)&&0===a.children.length)return null;let t=Array.isArray(a.children)&&a.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),r=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:r}}function tj(e){let t=(0,h.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,c.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}tI.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],tI.addAnnotation=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.addAnnotation(t,n)},tI.blur=e=>{var t;tR("Host blurred"),null==(t=e.editable)||t.blur()},tI.delete=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.delete(t,n)},tI.findDOMNode=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.findDOMNode(t)},tI.findByPath=(e,t)=>{var n;return(null==(n=e.editable)?void 0:n.findByPath(t))||[]},tI.focus=e=>{var t;tR("Host requesting focus"),null==(t=e.editable)||t.focus()},tI.focusBlock=e=>{var t;return null==(t=e.editable)?void 0:t.focusBlock()},tI.focusChild=e=>{var t;return null==(t=e.editable)?void 0:t.focusChild()},tI.getSelection=e=>e.editable?e.editable.getSelection():null,tI.getValue=e=>{var t;return null==(t=e.editable)?void 0:t.getValue()},tI.hasBlockStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasBlockStyle(t)},tI.hasListStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasListStyle(t)},tI.isCollapsedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isCollapsedSelection()},tI.isExpandedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isExpandedSelection()},tI.isMarkActive=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isMarkActive(t)},tI.insertChild=(e,t,n)=>{var r;return tR("Host inserting child"),null==(r=e.editable)?void 0:r.insertChild(t,n)},tI.insertBlock=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.insertBlock(t,n)},tI.insertBreak=e=>{var t;return null==(t=e.editable)?void 0:t.insertBreak()},tI.isVoid=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isVoid(t)},tI.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1],r=t.length>1&&"children"!==t[1];return r||n},tI.marks=e=>{var t;return null==(t=e.editable)?void 0:t.marks()},tI.select=(e,t)=>{var n;tR("Host setting selection",t),null==(n=e.editable)||n.select(t)},tI.removeAnnotation=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.removeAnnotation(t)},tI.toggleBlockStyle=(e,t)=>{var n;return tR("Host is toggling block style"),null==(n=e.editable)?void 0:n.toggleBlockStyle(t)},tI.toggleList=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.toggleList(t)},tI.toggleMark=(e,t)=>{var n;tR("Host toggling mark",t),null==(n=e.editable)||n.toggleMark(t)};let tO=el("components:DraggableChild"),tY=e=>{let{children:t,element:n,readOnly:r}=e,i=(0,w._7)(),l=(0,h.useRef)(),a=(0,h.useMemo)(()=>M.ML.isVoid(i,n),[i,n]),o=(0,h.useCallback)(e=>{let t=ef.get(i);if(!t)return;tO("handle drag over"),e.preventDefault(),e.dataTransfer.dropEffect="move";let n=w.F3.findEventRange(i,e);n&&(ed.set(i,n),M.YR.select(i,n))},[i]),s=(0,h.useCallback)(e=>{if(tO("Drag start"),ec.set(i,!0),ef.set(i,n),a){e.dataTransfer.effectAllowed="move";let t=e.currentTarget;if(t instanceof HTMLElement){let n=t.cloneNode(!0);if(l.current=n,n.style.width="".concat(t.clientWidth,"px"),n.style.height="".concat(t.clientHeight,"px"),n.style.position="absolute",n.style.top="-99999px",n.style.left="-99999px",document.body){document.body.appendChild(n);let r=t.getBoundingClientRect(),i=e.clientX-r.left,l=e.clientY-r.top;n.style.width="".concat(r.width,"px"),n.style.height="".concat(r.height,"px"),e.dataTransfer.setDragImage(n,i,l)}}}},[i,n,a]);return r?t:(0,c.jsx)("span",{draggable:a,onDragStart:s,onDragOver:o,children:t})};el("components:Leaf");let tW=e=>{let t=(0,w._7)(),n=(0,w.vt)(),{attributes:r,children:i,leaf:l,schemaTypes:a,keyGenerator:o,renderChild:s,readOnly:f}=e,p=h.useRef(null),d=i,u=n&&t.selection&&M.e6.isCollapsed(t.selection)||!1;if(M.xv.isText(l)&&l._type===a.span.name){let t=i.props.parent,r=t?[{_key:t._key},"children",{_key:l._key}]:[],o=a.decorators.map(e=>e.value),h=Z()((Array.isArray(l.marks)?l.marks:[]).filter(e=>o.includes(e)));h.forEach(t=>{let i=a.decorators.find(e=>e.value===t);i&&e.renderDecorator&&(d=e.renderDecorator({children:d,editorElementRef:p,focused:u,path:r,selected:n,type:i,value:t}))});let f=Array.isArray(l.marks)?l.marks:[],g=f.map(e=>!o.includes(e)&&t&&t.markDefs&&t.markDefs.find(t=>t._key===e)).filter(Boolean);if(t&&g.length>0&&g.forEach(i=>{let l=a.annotations.find(e=>e.name===i._type);l&&(d=e.renderAnnotation?(0,c.jsx)("span",{ref:p,children:e.renderAnnotation({block:t,children:d,editorElementRef:p,focused:u,path:r,selected:n,type:l,value:i})}):(0,c.jsx)(tj,{annotation:i,children:(0,c.jsx)("span",{ref:p,children:d})}))}),t&&s){let e=t.children.find(e=>e._key===l._key);if(e){let t=(0,c.jsx)(c.Fragment,{children:d});d=s({annotations:g,children:t,editorElementRef:p,focused:u,path:r,schemaType:a.span,selected:n,value:e})}}}let g=l._key||o();return(0,c.jsx)("span",{...r,ref:p,children:(0,c.jsx)(tY,{element:l,readOnly:f,children:d})},g)},tJ=e=>(0,c.jsx)("div",{children:(0,c.jsx)("pre",{children:JSON.stringify(e.value,null,2)})}),tz=ee.ZP.div(l||(l=et(["\n  user-select: none;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");ee.ZP.span(a||(a=et(["\n  background: #999;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");let tF=ee.ZP.div(o||(o=et(["\n  &.pt-list-item {\n    width: fit-content;\n    position: relative;\n    display: block;\n\n    /* Important 'transform' in order to force refresh the ::before and ::after rules\n      in Webkit: https://stackoverflow.com/a/21947628/831480\n    */\n    transform: translateZ(0);\n    margin-left: ",";\n  }\n  &.pt-list-item > .pt-list-item-inner {\n    display: flex;\n    margin: 0;\n    padding: 0;\n    &:before {\n      justify-content: flex-start;\n      vertical-align: top;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner:before {\n      content: '","';\n      font-size: 0.4375rem; /* 7px */\n      line-height: 1.5rem; /* Same as body text */\n      /* Optical alignment */\n      position: relative;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner {\n    &:before {\n      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */\n    }\n  }\n  &.pt-list-item-number {\n    counter-increment: ",";\n    counter-reset: ",";\n  }\n  & + :not(.pt-list-item-number) {\n    counter-reset: listItemNumber;\n  }\n  &.pt-list-item-number > .pt-list-item-inner:before {\n    content: ",";\n    min-width: 1.5rem; /* Make sure space between number and text never shrinks */\n    /* Optical alignment */\n    position: relative;\n    top: 1px;\n  }\n"])),e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel),e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?tU[(t-1)%3]:"*"},e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)),tV=ee.ZP.div(s||(s=et([""]))),tU=["","",""],tH=el("components:DraggableBlock"),t$=e=>{let{children:t,element:n,readOnly:r,blockRef:i}=e,l=(0,w._7)(),a=(0,h.useRef)(),[o,s]=(0,h.useState)(!1),f=(0,h.useMemo)(()=>M.ML.isVoid(l,n),[l,n]),p=(0,h.useMemo)(()=>M.ML.isInline(l,n),[l,n]),[d,u]=(0,h.useState)(null);(0,h.useEffect)(()=>u(i?i.current:w.F3.toDOMNode(l,n)),[l,n,i]);let g=(0,h.useCallback)(e=>{let t=eh.get(l);if(!t||!d)return;e.preventDefault(),e.dataTransfer.dropEffect="move",ep.set(l,n);let r=d.getBoundingClientRect(),i=r.top,a=r.height,o=e.pageY,c="bottom";if(n===l.children[0]?c="top":Math.abs(i-o)<a/2?(c="top",eu.set(l,c)):(c="bottom",eu.set(l,c)),t===n){e.dataTransfer.dropEffect="none";return}s(!0)},[d,l,n]),m=(0,h.useCallback)(()=>{s(!1)},[]),y=(0,h.useCallback)(e=>{let t=ep.get(l);if(t){ec.set(l,!1),e.preventDefault(),e.stopPropagation(),ep.delete(l),a.current&&(tH("Removing drag ghost"),document.body.removeChild(a.current));let r=eu.get(l);eu.delete(l);let i=w.F3.findPath(l,t),o=w.F3.findPath(l,n),s=M.y$.isBefore(o,i);if("bottom"===r&&!s){if(i[0]>=l.children.length-1){tH("target is already at the bottom, not moving");return}let e=i;i=M.y$.next(i),tH("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if("top"===r&&s&&i[0]!==l.children.length-1){let e=i;i=M.y$.previous(i),tH("Adjusting targetPath from ".concat(JSON.stringify(e)," to ").concat(JSON.stringify(i)))}if(M.y$.equals(i,o)){e.preventDefault(),tH("targetPath and myPath is the same, not moving");return}tH("Moving element ".concat(n._key," from path ").concat(JSON.stringify(o)," to ").concat(JSON.stringify(i)," (").concat(r,")")),M.YR.moveNodes(l,{at:o,to:i}),l.onChange();return}tH("No target element, not doing anything")},[l,n]),k=(0,h.useCallback)(e=>{eh.get(l)&&(tH("On drop (prevented)",n),e.preventDefault(),e.stopPropagation(),s(!1))},[l,n]),_=(0,h.useCallback)(e=>{if(!f){eh.delete(l);return}ec.set(l,!0),eh.set(l,n),e.stopPropagation();let t=e.target;t instanceof HTMLElement&&(t.style.opacity="1")},[l,n,f]),b=(0,h.useCallback)(e=>{if(!f||p){tH("Not dragging block"),eh.delete(l),ec.set(l,!1);return}if(tH("Drag start"),ec.set(l,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),d&&d instanceof HTMLElement){let t=d.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){a.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=d.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top;t.style.width="".concat(n.width,"px"),t.style.height="".concat(n.height,"px"),e.dataTransfer.setDragImage(t,r,i)}}_(e)},[d,l,_,p,f]),x=o&&l.children[0]===ep.get(l),E=o&&l.children[l.children.length-1]===ep.get(l),T=eu.get(l),N=(0,h.useMemo)(()=>(0,c.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return r?(0,c.jsx)(c.Fragment,{children:t}):(0,c.jsxs)("div",{draggable:f,onDragStart:b,onDrag:_,onDragOver:g,onDragLeave:m,onDragEnd:y,onDrop:k,children:[(x||o&&!x&&!E&&"top"===T)&&N,t,(E||o&&!x&&!E&&"bottom"===T)&&N]})};el("components:Element");let tq=[],tZ={display:"inline-block"},tG=e=>{let t,{attributes:n,children:r,element:i,schemaTypes:l,readOnly:a,renderBlock:o,renderChild:s,renderListItem:f,renderStyle:p,spellCheck:d}=e,u=(0,w._7)(),g=(0,w.vt)(),m=(0,h.useRef)(null),y=(0,h.useRef)(null),k=g&&u.selection&&M.e6.isCollapsed(u.selection)||!1,_=(0,h.useMemo)(()=>eb([i],l.block.name,em.get(u))[0],[u,i,l.block.name]),b=r,x=(0,h.useMemo)(()=>[{_key:i._key}],[i]);if("string"!=typeof i._type)throw Error("Expected element to have a _type property");if("string"!=typeof i._key)throw Error("Expected element to have a _key property");if(u.isInline(i)){let e=w.F3.findPath(u,i),[t]=M.ML.node(u,e,{depth:1}),o=l.inlineObjects.find(e=>e.name===i._type);if(!o)throw Error("Could not find type for inline block element");if(M.W_.isElement(t)){let e=[{_key:t._key},"children",{_key:i._key}];return(0,c.jsxs)("span",{...n,children:[r,(0,c.jsx)(tY,{element:i,readOnly:a,children:(0,c.jsxs)("span",{className:"pt-inline-object",ref:y,style:tZ,contentEditable:!1,children:[s&&s({annotations:tq,children:(0,c.jsx)(tJ,{value:_}),value:_,schemaType:o,focused:k,selected:g,path:e,editorElementRef:y}),!s&&(0,c.jsx)(tJ,{value:_})]},i._key)})]})}throw Error("Block not found!")}if(i._type===l.block.name){let e;t="pt-block pt-text-block";let s="listItem"in i,h="style"in i&&i.style||"normal";t="pt-block pt-text-block pt-text-block-style-".concat(h);let y=l.styles.find(e=>e.value===h);if(p&&y&&(b=p({block:i,children:r,focused:k,selected:g,value:h,path:x,type:y,editorElementRef:m})),s&&("number"==typeof i.level&&(e=i.level),t+=" pt-list-item pt-list-item-".concat(i.listItem," pt-list-item-level-").concat(e||1)),u.isListBlock(_)&&s&&i.listItem){let e=l.lists.find(e=>e.value===i.listItem);b=f&&e?f({block:_,children:b,focused:k,selected:g,value:i.listItem,path:x,type:e,level:_.level||1,editorElementRef:m}):(0,c.jsx)(tF,{listStyle:_.listItem||l.lists[0].value,listLevel:_.level||1,children:(0,c.jsx)(tV,{children:b})})}let w={children:b,editorElementRef:m,focused:k,level:e,listItem:s?i.listItem:void 0,path:x,selected:g,style:h,type:l.block,value:_},M=o?o(w):r;return(0,c.jsx)("div",{...n,className:t,spellCheck:d,children:(0,c.jsx)(t$,{element:i,readOnly:a,blockRef:m,children:(0,c.jsx)("div",{ref:m,children:M})})},i._key)}let E=l.blockObjects.find(e=>e.name===i._type);if(!E)throw Error("Could not find schema type for block element of _type ".concat(i._type));t="pt-block pt-object-block";let T=eb([i],l.block.name,em.get(u))[0],N=o&&o({children:(0,c.jsx)(tJ,{value:_}),value:T,type:E,selected:g,focused:k,path:x,editorElementRef:m});return(0,c.jsxs)("div",{...n,className:t,children:[r,(0,c.jsxs)(t$,{element:i,readOnly:a,blockRef:m,children:[N&&(0,c.jsx)("div",{ref:m,contentEditable:!1,children:N}),!N&&(0,c.jsx)(tz,{selected:g,children:(0,c.jsx)(tJ,{value:_})})]})]},i._key)},tK="undefined"==typeof window?h.useEffect:h.useLayoutEffect,tX=el("component:Editable"),tQ={opacity:.5,position:"absolute",userSelect:"none",pointerEvents:"none"},t0=[],t1=(0,h.forwardRef)(function(e,t){let{hotkeys:n,onBeforeInput:r,onPaste:i,onCopy:l,renderAnnotation:a,renderBlock:o,renderChild:s,renderDecorator:f,renderListItem:p,renderPlaceholder:d,renderStyle:u,selection:g,scrollSelectionIntoView:m,spellCheck:y,...k}=e,_=tE(),b=tD(),x=es(),E=function(e){let t=(0,h.useRef)(null);return tK(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(t),{change$:N,schemaTypes:A}=_,C=(0,w.ui)(),L=A.block.name,S=(0,h.useMemo)(()=>function(e){let t=A.block.name,n=A.span.name,r=t=>t.map(t=>{var r;return e.isTextBlock(t)?t.children.map(e=>{var t;return e._type===n?e.text:"[".concat((null==(t=A.inlineObjects.find(t=>t.name===e._type))?void 0:t.title)||"Object","]")}).join(""):"[".concat((null==(r=A.blockObjects.find(e=>e.name===t._type))?void 0:r.title)||"Object","]")}).join("\n\n");return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[a,o]=M.e6.edges(l),s=M.ML.void(e,{at:a.path}),c=M.ML.void(e,{at:o.path});if(M.e6.isCollapsed(l)&&!s)return;let h=w.F3.toDOMRange(e,l),f=h.cloneContents();if(c){let[t]=c,n=h.cloneRange(),r=w.F3.toDOMNode(e,t);n.setEndAfter(r),f=n.cloneContents()}Array.from(f.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""}),Array.from(f.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let p=f.ownerDocument.createElement("div");p.appendChild(f),p.setAttribute("hidden","true"),f.ownerDocument.body.appendChild(p);let d=p.innerHTML;f.ownerDocument.body.removeChild(p);let u=e.getFragment(),g=eb(u,t),m=JSON.stringify(g),y=r(g);n.clearData(),n.setData("text/plain",y),n.setData("text/html",d),n.setData("application/json",m),n.setData("application/x-portable-text",m),tg("text",y),n.setData("application/x-portable-text-event-origin",i||"external"),tg("Set fragment data",m,d)},e.insertPortableTextData=t=>{var r;if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),l=t.getData("application/x-portable-text-event-origin");if(tg("Inserting portable text from ".concat(l," event"),i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){let i=e_(t,{schemaTypes:A}).map(t=>{let r={...t};e.isTextBlock(r)&&(r.markDefs=(r.markDefs||[]).map(t=>{let i=t._key,l=x();return e.isTextBlock(r)&&(r.children=r.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(i)?[...t.marks].filter(e=>e!==i).concat(l):t.marks}:t)),{...t,_key:l}}));let i={...r,_key:x()};return e.isTextBlock(i)&&(i.children=i.children.map(e=>({...e,_key:x()}))),i}),l=tu(t,A,x);if(!l.valid){let e="".concat(null==(r=l.resolution)?void 0:r.description);return N.next({type:"error",level:"warning",name:"pasteError",description:e,data:l}),tg("Invalid insert result",l),!1}return ty(e,i),e.insertFragment(i),e.onChange(),!0}}return!1},e.insertTextOrHTMLData=n=>{var r;if(!e.selection)return tg("No selection, not inserting"),!1;N.next({type:"loading",isLoading:!0});let i=n.getData("text/html"),l=n.getData("text/plain");if(i||l){let a,o,s;if(tg("Inserting data",n),i)o=e_(a=(0,K.zW)(i,A.portableText).map(e=>(0,K.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="HTML";else{let e=String(l).replace(/[&<>"'`=/]/g,e=>tm[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join("");o=e_(a=(0,K.zW)("<html><body>".concat(e,"</body></html>"),A.portableText).map(e=>(0,K.nX)(e,{blockTypeName:t})),{schemaTypes:A}),s="text"}let c=tu(a,A,x);if(!c.valid){let e="Could not validate the resulting portable text to insert.\n".concat(null==(r=c.resolution)?void 0:r.description,"\nTry to insert as plain text (shift-paste) instead.");return N.next({type:"error",level:"warning",name:"pasteError",description:e,data:c}),tg("Invalid insert result",c),!1}return tg("Inserting ".concat(s," fragment at ").concat(JSON.stringify(e.selection))),ty(e,o),e.insertFragment(o),e.onChange(),N.next({type:"loading",isLoading:!1}),!0}return N.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[N,x,A]),P=(0,h.useMemo)(()=>(function(e,t,n,r){let i=["enter","tab","shift","delete","end"],l=r||td,a=()=>e_([{_type:e.block.name,_key:t(),style:"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0];return function(t){return t.pteWithHotKeys=r=>{Object.keys(l).forEach(e=>{if("marks"===e)for(let n in l[e]){if(i.includes(n))throw Error("The hotkey ".concat(n," is reserved!"));if((0,G.ZP)(n,r.nativeEvent)){r.preventDefault();let i=l[e];if(i){let e=i[n];tp("HotKey ".concat(n," to toggle ").concat(e)),t.pteToggleMark(e)}}}if("custom"===e)for(let t in l[e]){if(i.includes(t))throw Error("The hotkey ".concat(t," is reserved!"));if((0,G.ZP)(t,r.nativeEvent)){let i=l[e];if(i){let e=i[t];e(r,n)}}}});let o=(0,G.ZP)("enter",r.nativeEvent),s=(0,G.ZP)("tab",r.nativeEvent),c=(0,G.ZP)("shift+enter",r.nativeEvent),h=(0,G.ZP)("shift+tab",r.nativeEvent),f=(0,G.ZP)("backspace",r.nativeEvent),p=(0,G.ZP)("delete",r.nativeEvent);if(f&&t.selection&&t.selection.focus.path[0]>0&&M.e6.isCollapsed(t.selection)){let[e,n]=M.ML.node(t,M.y$.previous(t.selection.focus.path.slice(0,1))),[i]=M.ML.node(t,t.selection.focus,{depth:1});if(e&&i&&M.ML.isVoid(t,e)&&0===t.selection.focus.offset){tp("Preventing deleting void block above"),r.preventDefault(),r.stopPropagation(),M.YR.removeNodes(t,{match:e=>e===i}),M.YR.select(t,n),t.onChange();return}}if(p&&t.selection&&0===t.selection.focus.offset&&M.e6.isCollapsed(t.selection)&&t.children[t.selection.focus.path[0]+1]){let[e]=M.ML.node(t,M.y$.next(t.selection.focus.path.slice(0,1))),[n,i]=M.ML.node(t,t.selection.focus,{depth:1});if(e&&n&&!M.ML.isVoid(t,n)&&M.ML.isVoid(t,e)){tp("Preventing deleting void block below"),r.preventDefault(),r.stopPropagation(),M.YR.removeNodes(t,{match:e=>e===n}),M.YR.select(t,i),t.onChange();return}}if((s||h)&&t.selection){let[e]=M.ML.node(t,t.selection.focus,{depth:2}),[n]=(0,j.NG)(e)?M.ML.node(t,t.selection.focus,{depth:1}):[],i=e&&(0,j.DG)(n)&&(0,j.NG)(e)&&(e.marks||[]).filter(e=>(n.markDefs||[]).map(e=>e._key).includes(e)).length>0,[l]=M.e6.edges(t.selection),a=M.ML.isStart(t,l,l.path);e&&(0,j.NG)(e)&&(!i||a)&&t.pteIncrementBlockLevels(h)&&r.preventDefault()}if(o&&!c&&t.selection){let n;try{[n]=M.ML.node(t,t.selection.focus,{depth:1})}catch(e){}if(t.isListBlock(n)){t.pteEndList()&&r.preventDefault();return}if(t.isTextBlock(n)&&n.style&&n.style!==e.styles[0].value){let[,e]=M.e6.edges(t.selection),n=M.ML.isEnd(t,e,e.path);if(n){M.ML.insertNode(t,a()),r.preventDefault();return}}if(n&&M.ML.isVoid(t,n)){M.ML.insertNode(t,a()),r.preventDefault();return}}if(c){r.preventDefault(),t.insertText("\n");return}if((0,G.ZP)("mod+z",r.nativeEvent)){r.preventDefault(),t.undo();return}((0,G.ZP)("mod+y",r.nativeEvent)||(0,G.ZP)("mod+shift+z",r.nativeEvent))&&(r.preventDefault(),t.redo())},t}})(A,x,_,n),[n,x,_,A]);(0,h.useMemo)(()=>b?(tX("Editable is in read only mode"),S(C)):(tX("Editable is in edit mode"),S(P(C))),[b,C,P,S]);let R=(0,h.useCallback)(e=>(0,c.jsx)(tG,{...e,readOnly:b,renderBlock:o,renderChild:s,renderListItem:p,renderStyle:u,schemaTypes:A,spellCheck:y}),[A,y,b,o,s,p,u]),I=(0,h.useCallback)(e=>{let t=(0,c.jsx)(tW,{...e,keyGenerator:x,schemaTypes:A,renderAnnotation:a,renderChild:s,renderDecorator:f,readOnly:b});return d&&e.leaf.placeholder&&""===e.text.text?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{style:tQ,contentEditable:!1,children:d()}),t]}):t},[x,b,a,s,f,d,A]);(0,h.useEffect)(()=>{if(g){tX("Selection from props ".concat(JSON.stringify(g)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,r=null,{anchor:i,focus:l}=e;return(i&&t.find(e=>T()({_key:e._key},i.path[0]))&&(n=tB(i,t)),l&&t.find(e=>T()({_key:e._key},l.path[0]))&&(r=tB(l,t)),n&&r)?{anchor:n,focus:r}:null}(g,eb(C.children,L));if(null!==e){tX("Normalized selection from props ".concat(JSON.stringify(e)));let t=eR(e,C);t&&(M.YR.select(C,t),C.operations.some(e=>"set_selection"===e.type)||N.next({type:"selection",selection:e}),C.onChange())}}},[C,g,L,N]),(0,h.useEffect)(()=>{g&&tI.select(_,g)},[]);let B=(0,h.useCallback)(e=>{if(l){let t=l(e);void 0!==t&&e.preventDefault()}},[l]),O=(0,h.useCallback)(e=>{if(e.preventDefault(),C.selection){if(!i){tX("Pasting normally"),C.insertData(e.clipboardData);return}new Promise(t=>{var n;t(i({event:e,value:tI.getValue(_),path:(null==(n=C.selection)?void 0:n.focus.path)||[],schemaTypes:A}))}).then(t=>{if(tX("Custom paste function from client resolved",t),N.next({type:"loading",isLoading:!0}),!t||!t.insert){tX("No result from custom paste handler, pasting normally"),C.insertData(e.clipboardData);return}if(t&&t.insert){C.insertFragment(e_(t.insert,{schemaTypes:A})),N.next({type:"loading",isLoading:!1});return}console.warn("Your onPaste function returned something unexpected:",t)}).catch(e=>(N.next({type:"loading",isLoading:!1}),console.error(e),e))}},[N,i,_,A,C]),Y=(0,h.useCallback)(()=>{N.next({type:"focus"})},[N]),W=(0,h.useCallback)(()=>{N.next({type:"blur"})},[N]),J=(0,h.useCallback)(e=>{r&&r(e)},[r]),z=C.pteWithHotKeys,F=(0,h.useMemo)(()=>void 0===m?void 0:null===m?D():(e,t)=>{m(_,t)},[_,m]),V=(0,h.useCallback)(()=>ex(C.children,A)?[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}]:t0,[A,C]),U=(0,h.useMemo)(()=>(0,c.jsx)(w.CX,{autoFocus:!1,className:"pt-editable",decorate:V,onBlur:W,onCopy:B,onDOMBeforeInput:J,onFocus:Y,onKeyDown:z,onPaste:O,readOnly:b,renderElement:R,renderLeaf:I,scrollSelectionIntoView:F}),[V,B,z,J,W,Y,O,b,R,I,F]);return _?(0,c.jsx)("div",{ref:E,...k,children:U}):null})}}]);