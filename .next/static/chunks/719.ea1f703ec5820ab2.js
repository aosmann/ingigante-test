"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[719],{94415:function(e,t,n){n.d(t,{O:function(){return m}});var i=n(85893),r=n(40168),l=n(42930),s=n(11636),o=n(67294),u=n(32932),c=n(68467);n(57557),n(66996),n(933);let a=(e,t)=>({title:(0,i.jsxs)("em",{children:["No schema found for type ",(0,i.jsx)("code",{children:t})]}),subtitle:(0,i.jsxs)("em",{children:["Document: ",(0,i.jsx)("code",{children:e})]}),media:()=>(0,i.jsx)(r.foC,{})});function d(e){let{layout:t,value:n}=e;return(0,i.jsx)(u.ogX,{...a(n._id,n._type),layout:t})}function f(e,t,n){return!1!==e&&(e||t&&t.icon||n||!1)}function m(e){let{icon:t,id:n,layout:a="default",pressed:m,schemaType:h,selected:p,title:x,value:g}=e,j=(0,u.I_y)(),y=(0,u.rq_)(),{ChildLink:b}=(0,c.RL)(),v=(0,u.Dqo)(n),_=Boolean(h&&h.name&&j.get(h.name)),[k,C]=(0,o.useState)(!1),T=(0,o.useMemo)(()=>g&&(0,l.Si)(g)?h&&_?(0,i.jsx)(c.iJ,{documentPreviewStore:y,icon:f(t,h,r.$lS),layout:a,schemaType:h,value:g,presence:v}):(0,i.jsx)(d,{value:g}):(0,i.jsx)(u.ogX,{status:(0,i.jsx)(s.xv,{muted:!0,children:(0,i.jsx)(r.XCv,{})}),icon:f(t,h,r.ROc),layout:a,title:x}),[y,_,t,a,h,x,g,v]),w=(0,o.useMemo)(()=>function(e){return(0,i.jsx)(b,{...e,childId:n})},[b,n]),D=(0,o.useCallback)(()=>C(!0),[]);return(0,o.useEffect)(()=>C(!1),[p]),(0,i.jsx)(u.oUE,{__unstable_focusRing:!0,as:w,"data-as":"a","data-ui":"PaneItem",padding:2,radius:2,onClick:D,pressed:m,selected:p||k,tone:"inherit",children:T})}},40719:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var i=n(85893),r=n(67294),l=n(11636),s=n(38993),o=n.n(s),u=n(40168);n(933);var c=n(68467),a=n(75706),d=n(66996),f=n(42930),m=n(32932),h=n(94415);n(57557),n(81763),n(47037),n(28440);var p=n(82649),x=n(23071),g=n(32817),j=n(69243),y=n(22401),b=n(29127),v=n(53741),_=n(40148),k=n(30218),C=n(34978),T=n(65583),w=n(46297),D=n(83505),M=n(98430),R=n(79878),W=n(74727),L=n(48902),X=n(56542),$=n(94975),B=n(69590),O=n.n(B);let S={by:[{field:"_updatedAt",direction:"desc"}]},E={};function I(e,t){return e._id?(0,m.vsM)(e._id):"item-".concat(t)}let q=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function z(e){let{childItemId:t,error:n,filterIsSimpleTypeContraint:s,fullList:o,isActive:d,isLoading:f,items:p,layout:x,onListChange:g,onRetry:j,showIcons:y}=e,b=(0,m.I_y)(),{collapsed:v}=(0,c.Cc)(),{collapsed:_,index:k}=(0,c.ec)(),[C,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(_)return;let e=setTimeout(()=>{T(!0)},0);return()=>{clearTimeout(e)}},[_]);let w=(0,r.useCallback)(e=>{let n=(0,m.vsM)(e._id),r=t===n;return(0,i.jsx)(h.O,{icon:!1!==y&&void 0,id:n,pressed:!d&&r,selected:d&&r,layout:x,schemaType:b.get(e._type),value:e})},[t,d,x,b,y]),D=(0,r.useMemo)(()=>{if(!C)return null;if(n)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(l.W2,{width:1,children:(0,i.jsxs)(l.Kq,{paddingX:4,paddingY:5,space:4,children:[(0,i.jsx)(l.X6,{as:"h3",children:"Could not fetch list items"}),(0,i.jsxs)(l.xv,{as:"p",children:["Error: ",(0,i.jsx)("code",{children:n.message})]}),j&&(0,i.jsx)(l.xu,{children:(0,i.jsx)(l.zx,{icon:u.bnu,onClick:j,text:"Retry",tone:"primary"})})]})})});if(null===p)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(a.Delay,{ms:300,children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.$j,{muted:!0}),(0,i.jsx)(l.xu,{marginTop:3,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:1,children:"Loading documents…"})})]})})});if(!f&&0===p.length)return(0,i.jsx)(l.kC,{align:"center",direction:"column",height:"fill",justify:"center",children:(0,i.jsx)(l.W2,{width:1,children:(0,i.jsx)(l.xu,{paddingX:4,paddingY:5,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:2,children:s?"No documents of this type":"No matching documents"})})})});let e=o&&2e3===p.length;return(0,i.jsxs)(l.xu,{padding:2,children:[p.length>0&&(0,i.jsx)(l.CP,{gap:1,getItemKey:I,items:p,renderItem:w,onChange:g},"".concat(k,"-").concat(_)),f&&(0,i.jsx)(l.Zb,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:(0,i.jsx)(l.xv,{align:"center",muted:!0,size:1,children:"Loading…"})}),e&&(0,i.jsx)(l.Zb,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:(0,i.jsxs)(l.xv,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",2e3," documents"]})})]})},[n,s,o,g,f,p,j,w,C,_,k]);return(0,i.jsx)(c.Bh,{overflow:v?void 0:"auto",children:D})}let N=(0,r.memo)(e=>{let{index:t,initialValueTemplates:n=[],menuItems:s=[],menuItemGroups:o=[],setLayout:d,setSortOrder:f,title:m}=e,{features:h}=(0,a.useDeskTool)(),p=(0,r.useMemo)(()=>({setLayout:e=>{let{layout:t}=e;d(t)},setSortOrder:e=>{f(e)}}),[d,f]);return(0,i.jsx)(c.hX,{backButton:h.backButton&&t>0&&(0,i.jsx)(l.zx,{as:c.hb,"data-as":"a",icon:u.Y4O,mode:"bleed"}),title:m,actions:(0,i.jsx)(c.cp,{initialValueTemplateItems:n,actionHandlers:p,menuItemGroups:o,menuItems:s})})});N.displayName="DocumentListPaneHeader";let P={result:null,error:!1},Y=e=>({result:{documents:e},loading:!1,error:!1}),K=e=>({result:null,loading:!1,error:e}),U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new p.x,i=n.next.bind(n),r=e.pipe((0,b.U)(e=>({client:e.client,query:e.query,params:e.params})),(0,v.x)(O()),(0,_._)(1),(0,k.x)()),l=r.pipe((0,C.w)(e=>{let n=(0,m.OPK)(e.client,e.query,e.params,t).pipe((0,b.U)(Y),(0,T.B)());return(0,x.T)((0,g.of)({loading:!0}).pipe((0,w.g)(400),(0,D.R)(n)),n)}));return l.pipe((0,M.O)(P),(0,R.K)((e,t)=>(0,j.z)((0,g.of)(K(e)),(0,x.T)((0,y.R)(window,"online"),n).pipe((0,W.q)(1),(0,L.j)(t)))),(0,X.R)((e,t)=>({...e,...t,onRetry:i})))},F=[],V=(0,r.memo)(function(e){let{childItemId:t,index:n,isActive:l,isSelected:s,pane:u,paneKey:h}=e,p=(0,m.I_y)(),{name:x}=(0,m.Lky)(),{defaultLayout:j="default",displayOptions:y,initialValueTemplates:b=F,menuItems:v,menuItemGroups:_,options:k,title:C}=u,{apiVersion:T,defaultOrdering:w=F,filter:D}=k,M=function(e){let t=(0,r.useRef)(e);return o()(t.current,e)||(t.current=e),t.current}(k.params||E),R=u.source,W=(0,r.useMemo)(()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(q);if(!n)return null;let i=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if("$"===i[0]){let e=i.slice(1),n=t[e];return"string"==typeof n?n:null}return i})(D,M),[D,M]),L=(null==y?void 0:y.showIcons)!==!1,[X,B]=(0,a.useDeskToolSetting)(W,"layout",j),O=(0,r.useMemo)(()=>(null==w?void 0:w.length)>0?{by:w}:S,[w]),[I,P]=(0,a.useDeskToolSetting)(W,"sortOrder",O),Y=W&&I?function(e,t){let n=e.by.map(e=>{if(e.mapWith)return e;let n=function(e,t){let n=d.mL(t),i=e;for(let e of n){if(!i)return;if("string"==typeof e){i=function(e,t){if(!("fields"in e))return;let n=e.fields.find(e=>e.name===t);return n?n.type:void 0}(i,e);continue}let t=(0,f.Fd)(e)||(0,f.dw)(e);if(!t||"array"!==i.jsonType)return;let[n,r]=i.of||[];if(r||!n)return;if(!(0,f.dD)(n)){i=n;continue}let[l,s]=n.to||[];if(s||!l)return;i=l}return i}(t,e.field);return n?!function(e,t){let n=e.type;for(;n;){if(n.name===t||!n.type&&n.jsonType===t)return!0;n=n.type}return!1}(n,"datetime")?"string"===n.jsonType?{...e,mapWith:"lower"}:e:{...e,mapWith:"dateTime"}:e});return n.every((t,n)=>t===e.by[n])?e:{...e,by:n}}(I,p.get(W)):I,K=(0,m.BoV)(Y),V=/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(D.trim()),{error:Z,fullList:A,handleListChange:H,isLoading:J,items:G,onRetry:Q}=function(e){var t;let{apiVersion:n,filter:i,params:l,sortOrder:s}=e,o=(0,m.m85)(m.Dr7),[u,c]=(0,r.useState)(!1),a=(0,r.useRef)(u),[d,f]=(0,r.useState)(null),h=(null==d?void 0:d.error)||null,p=(null==d?void 0:d.loading)||null===d,x=null==d?void 0:d.onRetry,j=null==(t=null==d?void 0:d.result)?void 0:t.documents,y=(0,r.useMemo)(()=>j?(0,m.RgL)(j).map(e=>{let t=e.draft||e.published;return{...t,hasPublished:!!e.published,hasDraft:!!e.draft}}):null,[j]),b=(0,r.useMemo)(()=>{let e=null==s?void 0:s.extendedProjection,t=["_id","_type"],n=t.join(","),r=(null==s?void 0:s.by)||[],l=u?2e3:100,o=r.length>0?r:S.by,c=o.map(e=>[e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field,(e.direction||"").toLowerCase()].map(e=>e.trim()).filter(Boolean).join(" ")).join(",");if(e){let r=t.concat(e).join(",");return["*[".concat(i,"] {").concat(r,"}"),"order(".concat(c,") [0...").concat(l,"]"),"{".concat(n,"}")].join("|")}return"*[".concat(i,"]|order(").concat(c,")[0...").concat(l,"]{").concat(n,"}")},[i,u,s]),v=(0,r.useCallback)(e=>{let{toIndex:t}=e;p||a.current||!(t>=50)||(c(!0),a.current=!0)},[p]);return(0,r.useEffect)(()=>{f(e=>e?{...e,loading:!0}:null);let e=U((0,g.of)({client:o,query:b,params:l}),{apiVersion:n,tag:"desk.document-list"}).pipe((0,$.h)(u?e=>Boolean(e.result):()=>!0)),t=e.subscribe(f);return()=>t.unsubscribe()},[n,o,u,b,l]),(0,r.useEffect)(()=>{f(null),c(!1),a.current=!1},[i,l,s,n]),{error:h,fullList:u,handleListChange:v,isLoading:p,items:y,onRetry:x}}({filter:D,params:M,sortOrder:K,apiVersion:T});return(0,i.jsx)(m.cWh,{name:R||x,children:(0,i.jsxs)(c.X6,{currentMaxWidth:350,id:h,maxWidth:640,minWidth:320,selected:s,children:[c.Oo,(0,i.jsx)(N,{index:n,initialValueTemplates:b,menuItems:v,menuItemGroups:_,setLayout:B,setSortOrder:P,title:C}),(0,i.jsx)(z,{childItemId:t,error:Z,filterIsSimpleTypeContraint:V,fullList:A,isActive:l,isLoading:J,items:G,layout:X,onListChange:H,onRetry:Q,showIcons:L})]})})})}}]);